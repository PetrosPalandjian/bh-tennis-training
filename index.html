<!DOCTYPE html>
<!-- build: v2026-02-10-auth-sync-3 -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Belmont Hill Tennis Training Hub</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="vendor.supabase.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f7f8fa; }
    button:disabled { opacity: 0.5; cursor: not-allowed !important; }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-thumb { background: #D1D5DB; border-radius: 3px; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
// === data.js ===
const BH = {
  navy:"#1B365D",navyLight:"#2C5282",navyDark:"#0F1F38",
  maroon:"#7A1C2A",maroonLight:"#943548",maroonDim:"#5E1520",
  white:"#FFF",offWhite:"#F7F8FA",
  g100:"#F3F4F6",g200:"#E5E7EB",g300:"#D1D5DB",
  g400:"#9CA3AF",g500:"#6B7280",g700:"#374151",g800:"#1F2937",
  courtGreen:"#1B6B2B",courtDark:"#145220",
  shotBlue:"#3B82F6",shotRed:"#EF4444",shotGold:"#F59E0B",
};

const CRT={W:400,H:760,PAD:30};
const cw=CRT.W-2*CRT.PAD,ch=CRT.H-2*CRT.PAD;
const mX=x=>CRT.PAD+(x/100)*cw;
const mY=y=>CRT.PAD+(y/100)*ch;
const SL={l:CRT.PAD+(4.5/36)*cw,r:CRT.W-CRT.PAD-(4.5/36)*cw};
const NET_Y=mY(50);
const SVC={far:NET_Y-(21/39)*(ch/2),near:NET_Y+(21/39)*(ch/2)};

const POSES={
  forehand:[9,-2,22,-10,-55],backhand:[-9,-2,-22,-10,55],
  serve:[5,-6,8,-24,-10],fh_volley:[8,-4,18,-12,-45],bh_volley:[-8,-4,-18,-12,45],
  overhead:[4,-5,6,-23,-5],slice_fh:[10,-1,20,-6,-65],slice_bh:[-10,-1,-20,-6,65],
};
const BODY_ROT={forehand:25,backhand:-25,serve:12,fh_volley:15,bh_volley:-15,overhead:10,slice_fh:20,slice_bh:-20};

const beep=(freq,dur,vol=0.25)=>{try{const c=new(window.AudioContext||window.webkitAudioContext)(),o=c.createOscillator(),g=c.createGain();o.frequency.value=freq;o.type="sine";g.gain.setValueAtTime(vol,c.currentTime);g.gain.exponentialRampToValueAtTime(0.001,c.currentTime+dur/1000);o.connect(g);g.connect(c.destination);o.start();o.stop(c.currentTime+dur/1000)}catch(e){}};
const snd={
  go:()=>{beep(880,150);setTimeout(()=>beep(880,150),200);setTimeout(()=>beep(1100,250),400)},
  rest:()=>beep(440,400,0.2),tick:()=>beep(660,80,0.15),
  done:()=>{beep(523,120);setTimeout(()=>beep(659,120),160);setTimeout(()=>beep(784,120),320);setTimeout(()=>beep(1047,350),480)},
};

const EXERCISES=[
  {id:"russian-twist",name:"Russian Twists",cat:"Core",desc:"Sit tall, lean back slightly, rotate through your ribs, and keep the legs quiet. Control every rep.",reps:"20 reps",equip:"Med Ball 8-12lb",youtubeId:"LlccOWys8IU"},
  {id:"plank",name:"Plank Hold",cat:"Core",desc:"Elbows under shoulders, glutes tight, ribs down. Hold a straight line head-to-heels.",reps:"45 sec",equip:"None",youtubeId:"UQ78pw0WNZI",youtubeStart:0,youtubeEnd:15},
  {id:"bicycle",name:"Bicycle Crunches",cat:"Core",desc:"Slow and controlled elbow-to-knee. Keep low back glued down and neck relaxed.",reps:"20 each",equip:"None",youtubeId:"kUY4WA71e0Q",youtubeStart:3,youtubeEnd:29},
  {id:"dead-bug",name:"Dead Bugs",cat:"Core",desc:"Press low back into the floor, extend opposite arm/leg, and keep ribs down.",reps:"10 each",equip:"None",youtubeId:"vWGVXZltbqE"},
  {id:"v-ups",name:"V-Ups",cat:"Core",desc:"Lift legs and torso together, reach tall, then lower under control.",reps:"15 reps",equip:"None",youtubeId:"Vnep1dTa_IQ"},
  {id:"side-plank",name:"Side Plank",cat:"Core",desc:"Stack shoulders and hips, lift to a straight line, and keep the glutes tight.",reps:"30s each",equip:"None",youtubeId:"fMDZyiEAGZw"},
  {id:"glute-bridge",name:"Glute Bridges",cat:"Core",desc:"Drive through heels, squeeze glutes, ribs down. Pause at the top.",reps:"15 reps",equip:"None",youtubeId:"QHWp3TbfY3w"},
  {id:"rot-throw",name:"Rotational Throws",cat:"Rotation",desc:"Load the hips, rotate hard, and throw explosively. Catch and reset under control.",reps:"10 each",equip:"Med Ball + Wall",youtubeId:"A-WchCuHC4c"},
  {id:"woodchop",name:"Band Woodchops",cat:"Rotation",desc:"Pull high-to-low on a diagonal, rotate through the torso, and control the return.",reps:"12 each",equip:"Resistance Band",youtubeId:"EeFp3ggbr1c"},
  {id:"pallof-press",name:"Pallof Press",cat:"Rotation",desc:"Press straight out and resist rotation. Ribs down, glutes on.",reps:"10 each",equip:"Resistance Band",youtubeId:"6wV02D5aAWA"},
  {id:"torso-rot",name:"Standing Rotation",cat:"Rotation",desc:"Band at chest height, rotate the torso while keeping hips quiet and knees soft.",reps:"15 each",equip:"Resistance Band",youtubeId:"2iZC699PsZg"},
  {id:"ladder",name:"Ladder Drills",cat:"Agility",desc:"Fast feet, light steps, and clean patterns. Stay low and stay quick.",reps:"4 lengths",equip:"Agility Ladder",youtubeId:"afgg4HUhqcQ"},
  {id:"cone-shuffle",name:"Cone Shuffles",cat:"Agility",desc:"Stay low, chest up, and push off the outside leg. Touch the cone and go.",reps:"8 trips",equip:"2 Cones",youtubeId:"QnWw-fYURww"},
  {id:"split-step",name:"Split Step Jumps",cat:"Agility",desc:"Small hop, land wide on the balls of your feet, then explode to the ball.",reps:"20 reps",equip:"None",youtubeId:"dU6tm_gaqO4"},
  {id:"suicides",name:"Suicide Sprints",cat:"Agility",desc:"Touch each line, change direction hard, and keep the pace honest.",reps:"4 sets",equip:"4 Cones",youtubeId:"jXQAt9zQWeI"},
  {id:"sprint-back",name:"Sprint + Backpedal",cat:"Agility",desc:"Sprint out, decelerate under control, then backpedal with low hips.",reps:"6 trips",equip:"None",youtubeId:"a2sCgSIOFIg"},
  {id:"lateral-bounds",name:"Lateral Bounds",cat:"Agility",desc:"Explode side-to-side, stick the landing, knee over toes, chest up.",reps:"8 each",equip:"None",youtubeId:"yy6-tNgn_jY"},
  {id:"shuffle-sprint",name:"Shuffle to Sprint",cat:"Agility",desc:"Shuffle 3-4 steps then explode into a sprint; decelerate under control.",reps:"6 trips",equip:"2 Cones",youtubeId:"BoOUTG9BmSw"},
  {id:"box-jump",name:"Box Jumps",cat:"Lower Body",desc:"Swing arms, jump tall, land softly in a squat, and step down each rep.",youtubeId:"WgbMsNeTcoA",reps:"12 reps",equip:'20-24" Box'},
  {id:"lat-lunge",name:"Lateral Lunges",cat:"Lower Body",desc:"Hinge back into the hip, keep the planted leg straight, and drive out strong.",reps:"10 each",equip:"None",youtubeId:"pX77ux9avK0"},
  {id:"squat-jump",name:"Squat Jumps",cat:"Lower Body",desc:"Drop to a strong squat, explode up, and land softly into the next rep.",reps:"15 reps",equip:"None",youtubeId:"72BSZupb-1I"},
  {id:"single-hop",name:"Single Leg Hops",cat:"Lower Body",desc:"Hop on one leg, land quietly, knee tracking over toes, then stick the balance.",reps:"8 each",equip:"None",youtubeId:"BOLTnfYNgQ0"},
  {id:"split-squat",name:"Rear-Foot Elevated Split Squats",cat:"Lower Body",desc:"Front foot flat, torso tall, drop straight down, drive up strong.",reps:"8 each",equip:"Dumbbells + Bench",youtubeId:"I3p2bdtluUk"},
  {id:"single-rdl",name:"Single-Leg RDLs",cat:"Lower Body",desc:"Hinge at the hip, keep hips square, long spine, slight knee bend.",reps:"8 each",equip:"Dumbbells",youtubeId:"-4B8U5hoWaY"},
  {id:"calf-raise",name:"Calf Raises",cat:"Lower Body",desc:"Full range: pause at the top, squeeze hard, then lower slowly.",reps:"20 reps",equip:"Step",youtubeId:"YMmgqO8Jo-k"},
  {id:"copenhagen",name:"Copenhagen Plank",cat:"Prehab",desc:"Top leg on bench/box, lift hips, keep body long and steady.",reps:"20-30s each",equip:"Bench/Box",youtubeId:"ghDhAKRzFZM"},
  {id:"wall-throw",name:"Wall Throws",cat:"Upper Body",desc:"Explosive chest pass to the wall, catch the rebound, and reset fast.",reps:"15 reps",equip:"Med Ball + Wall",youtubeId:"zukE-ziGls4"},
  {id:"pushups",name:"Push-Up Variations",cat:"Upper Body",desc:"Hands under shoulders, body straight, chest to floor, full lockout.",reps:"15 reps",equip:"None",youtubeId:"B_Qgxbabd6E"},
  {id:"band-pull",name:"Band Pull-Aparts",cat:"Upper Body",desc:"Pull the band apart, squeeze shoulder blades, and avoid shrugging.",reps:"15 reps",equip:"Resistance Band",youtubeId:"NqFnPPjib-Q"},
  {id:"band-er",name:"Band External Rotations",cat:"Upper Body",desc:"Elbow at side, rotate forearm out, slow and controlled return.",reps:"12 each",equip:"Resistance Band",youtubeId:"19p6nWFHaRI"},
  {id:"face-pull",name:"Band Face Pulls",cat:"Upper Body",desc:"Pull band to face, elbows high, squeeze shoulder blades.",reps:"12 reps",equip:"Resistance Band",youtubeId:"CSP7YpPv3ds"},
  {id:"db-row",name:"Dumbbell Rows",cat:"Upper Body",desc:"Flat back, pull elbow to hip, control the lower.",reps:"10 each",equip:"Dumbbell",youtubeId:"xl1YiqQY2vA"},
  {id:"oh-throw",name:"Overhead Throws",cat:"Upper Body",desc:"Load hips, drive up, and throw overhead with full-body power.",reps:"12 reps",equip:"Med Ball",youtubeId:"z1JiHB8a4PY"},
  {id:"med-slam",name:"Med Ball Slams",cat:"Upper Body",desc:"Reach tall, slam hard, hinge at hips, reset fast.",reps:"12 reps",equip:"Med Ball",youtubeId:"bbXJ8expGdc"},
  {id:"jump-rope",name:"Jump Rope",cat:"Cardio",desc:"Small, quick jumps with wrists turning the rope and elbows tucked.",reps:"Full duration",equip:"Jump Rope",youtubeId:"nMHfZ-yrFjA"},
  {id:"mt-climbers",name:"Mountain Climbers",cat:"Cardio",desc:"Shoulders over wrists, core tight, and drive knees fast under control.",reps:"30 reps",equip:"None",youtubeId:"De3Gl-nC7IQ"},
  {id:"burpees",name:"Burpees",cat:"Cardio",desc:"Hands down, jump back, chest to floor, snap feet in, then jump up.",reps:"10 reps",equip:"None",youtubeId:"c1M1wjeZOYY"},
  {id:"high-knees",name:"High Knees",cat:"Cardio",desc:"Drive knees above hip height, pump the arms, and stay light on your feet.",reps:"30 sec",equip:"None",youtubeId:"lR3cpCVBjPM"}];
const EX_CATS=["All",...Array.from(new Set(EXERCISES.map(e=>e.cat)))];

const STRETCHES=[
  {id:"leg-swings",name:"Leg Swings (Front/Back)",type:"Dynamic",area:"Hips/Hamstrings",desc:"Hold a fence or wall. Swing the leg forward and back under control, stay tall.",reps:"10 each"},
  {id:"leg-swings-side",name:"Leg Swings (Side-to-Side)",type:"Dynamic",area:"Hips/Groin",desc:"Open the hip and swing across the body, then out to the side.",reps:"10 each"},
  {id:"walking-lunge-twist",name:"Walking Lunge + Twist",type:"Dynamic",area:"Hip Flexors/Thoracic",desc:"Step into a lunge, rotate toward the front leg, then switch.",reps:"8 each"},
  {id:"inch-worms",name:"Inchworms",type:"Dynamic",area:"Posterior Chain/Shoulders",desc:"Hinge forward, walk hands out to plank, then walk feet in.",reps:"6 reps"},
  {id:"worlds-greatest",name:"World's Greatest Stretch",type:"Dynamic",area:"Hips/Thoracic",desc:"Lunge, elbow to instep, then rotate the chest to the sky.",reps:"5 each"},
  {id:"arm-circles",name:"Arm Circles",type:"Dynamic",area:"Shoulders",desc:"Small to large circles forward and backward.",reps:"20 each way"},
  {id:"high-knee-hugs",name:"High Knee Hugs",type:"Dynamic",area:"Glutes/Hips",desc:"Pull knee to chest, rise tall, then switch legs.",reps:"8 each"},
  {id:"quad-pull-walk",name:"Walking Quad Pull",type:"Dynamic",area:"Quads/Hip Flexors",desc:"Grab ankle, pull heel to glute, squeeze glute, step forward.",reps:"8 each"},
  {id:"a-skips",name:"A-Skips",type:"Dynamic",area:"Calves/Hip Flexors",desc:"Drive the knee up, dorsiflex the foot, and stay tall.",reps:"2 x 15 yards"},
  {id:"karaoke",name:"Karaoke (Grapevine)",type:"Dynamic",area:"Hips/Groin",desc:"Cross behind and in front while staying low and controlled.",reps:"2 x 15 yards"},
  {id:"lat-lunge-reach",name:"Lateral Lunge + Reach",type:"Dynamic",area:"Adductors/Thoracic",desc:"Sit into the hip, keep the other leg long, and reach over.",reps:"6 each"},
  {id:"open-close-gate",name:"Open/Close the Gate",type:"Dynamic",area:"Hips",desc:"Lift the knee and rotate the hip open, then close across the body.",reps:"8 each"},
  {id:"scorpion",name:"Scorpion Kicks",type:"Dynamic",area:"Hip Flexors/Thoracic",desc:"Prone, lift one leg and reach across to the opposite side.",reps:"6 each"},
  {id:"shuffle-arm-swing",name:"Side Shuffle + Arm Swings",type:"Dynamic",area:"Hips/Shoulders",desc:"Short lateral shuffles while swinging the arms across the body.",reps:"2 x 10 yards"},
  {id:"rev-lunge-knee",name:"Reverse Lunge to Knee Drive",type:"Dynamic",area:"Glutes/Balance",desc:"Step back into a lunge, then drive the knee up and hold tall.",reps:"6 each"},
  {id:"ankle-hops",name:"Ankle Hops",type:"Dynamic",area:"Ankles/Achilles",desc:"Small quick hops, stay on the balls of your feet.",reps:"20 reps"},
  {id:"hamstring",name:"Seated Hamstring Stretch",type:"Static",area:"Hamstrings",desc:"Sit tall, hinge at the hips, and reach to the shin or toe.",reps:"30 sec"},
  {id:"quad",name:"Standing Quad Stretch",type:"Static",area:"Quads",desc:"Knees together, pelvis tucked, hold the ankle gently.",reps:"30 sec each"},
  {id:"calf",name:"Wall Calf Stretch",type:"Static",area:"Calves",desc:"Back heel down, knee straight, lean into the wall.",reps:"30 sec each"},
  {id:"hip-flexor",name:"Half-Kneeling Hip Flexor",type:"Static",area:"Hip Flexors",desc:"Tuck pelvis, squeeze glute, shift forward slightly.",reps:"30 sec each"},
  {id:"figure-4",name:"Figure-4 Glute Stretch",type:"Static",area:"Glutes",desc:"Cross ankle over knee, pull the legs in until you feel the stretch.",reps:"30 sec each"},
  {id:"adductor",name:"Butterfly Groin Stretch",type:"Static",area:"Groin",desc:"Feet together, knees out, hinge forward with a long spine.",reps:"30 sec"},
  {id:"childs-pose",name:"Child's Pose",type:"Static",area:"Back/Lats",desc:"Sit hips back, reach long through the arms, breathe deep.",reps:"45 sec"},
  {id:"cross-body",name:"Cross-Body Shoulder Stretch",type:"Static",area:"Shoulders",desc:"Pull arm across the chest, keep shoulders down.",reps:"30 sec each"},
  {id:"triceps",name:"Overhead Triceps Stretch",type:"Static",area:"Triceps/Shoulders",desc:"Elbow up, gentle pull with the other hand.",reps:"30 sec each"},
  {id:"pigeon",name:"Pigeon Stretch",type:"Static",area:"Glutes/Piriformis",desc:"Front leg bent, back leg long, hinge forward as tolerated.",reps:"30 sec each"},
  {id:"couch-stretch",name:"Couch Stretch",type:"Static",area:"Hip Flexors/Quads",desc:"Back shin on wall/bench, keep ribs down, squeeze glute.",reps:"30 sec each"},
  {id:"soleus",name:"Bent-Knee Calf Stretch",type:"Static",area:"Soleus",desc:"Back heel down, knee bent, lean forward slightly.",reps:"30 sec each"},
  {id:"hamstring-strap",name:"Supine Hamstring with Strap",type:"Static",area:"Hamstrings",desc:"Lie on back, loop strap, and gently straighten the knee.",reps:"30 sec each"},
  {id:"sleeper",name:"Sleeper Stretch",type:"Static",area:"Posterior Shoulder",desc:"Side-lying, gently rotate the forearm down.",reps:"30 sec each"},
  {id:"pec-doorway",name:"Doorway Pec Stretch",type:"Static",area:"Chest/Shoulders",desc:"Forearm on the doorframe, step through until gentle stretch.",reps:"30 sec each"},
  {id:"forearm",name:"Forearm Flexor/Extensor Stretch",type:"Static",area:"Forearms",desc:"Straight arm, palm down then up, gently pull fingers.",reps:"30 sec each"},
  {id:"spinal-twist",name:"Supine Spinal Twist",type:"Static",area:"Low Back/Hips",desc:"Knees to one side, shoulders heavy, breathe deep.",reps:"30 sec each"}
];
const STRETCH_TYPES=["All",...Array.from(new Set(STRETCHES.map(s=>s.type)))];

const DRILLS=[
  {
    id:"cc-fh",name:"Crosscourt Forehand",cat:"Groundstrokes",diff:"Beginner",skill:"Forehand",
    desc:"Rally crosscourt FH from deuce side. Both players start on the deuce (right) side of the baseline. Hit forehands diagonally crosscourt to each other, aiming deep into the service box corner. Focus on consistent topspin, high net clearance, and recovering to center after each shot.",
    tips:["Keep a high net clearance — aim 3-5 feet over the net","Follow through across your body for natural topspin","Small split step between shots to stay balanced","Turn sideways before contact and rotate through the core","Use targets or cones in the crosscourt zone to build accuracy"],
    youtubeId:"UwIPqGkQO80",youtubeStart:80,youtubeEnd:150,courtType:"singles",
    players:[{id:"A",x:50,y:95,color:BH.shotBlue},{id:"B",x:50,y:5,color:BH.shotRed}],
    steps:[
      {t:"move",f:[50,95],to:[72,95],c:BH.shotBlue,note:"A moves to deuce side"},
      {t:"hit",f:[72,95],to:[28,8],c:BH.shotBlue,n:"1",shot:"forehand",hitter:"A",note:"Crosscourt FH deep"},
      {t:"move",f:[72,95],to:[50,95],c:BH.shotBlue,note:"A recovers to center"},
      {t:"move",f:[50,5],to:[28,5],c:BH.shotRed,note:"B moves to ball"},
      {t:"hit",f:[28,5],to:[72,95],c:BH.shotRed,n:"2",shot:"forehand",hitter:"B",note:"Crosscourt FH back"},
      {t:"move",f:[28,5],to:[50,5],c:BH.shotRed,note:"B recovers to center"},
      {t:"move",f:[50,95],to:[72,95],c:BH.shotBlue,note:"A moves to ball"},
      {t:"hit",f:[72,95],to:[28,8],c:BH.shotBlue,n:"3",shot:"forehand",hitter:"A",note:"Crosscourt FH deep"},
      {t:"move",f:[72,95],to:[50,95],c:BH.shotBlue,note:"A recovers to center"}
    ]
  },
  // === SKILL FOCUS ADDITIONS (VIDEO-BASED, TIMECODED) ===
  {
    id:"sv-grip",name:"Serve Progression 1: Impact & Pronation",cat:"Skill Focus",diff:"Beginner",skill:"Serve",
    desc:"Isolate contact and pronation without a full swing.",
    tips:["Continental (hammer) grip","High-five the ball","Loose hand = faster snap"],
    youtubeId:"QiVszYWaIO0",youtubeStart:274,youtubeEnd:368,courtType:"singles",
    players:[{id:"S",x:50,y:52,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[50,52],to:[50,52],c:BH.shotBlue,note:"Stand near service line"},
      {t:"move",f:[50,52],to:[50,52],c:BH.shotBlue,note:"Racket high at contact"},
      {t:"move",f:[50,52],to:[50,52],c:BH.shotBlue,note:"Toss slightly in front"},
      {t:"hit",f:[50,52],to:[50,25],c:BH.shotBlue,n:"1",shot:"serve",hitter:"S",note:"High-five + pronate"}
    ]
  },
  {
    id:"sv-stance",name:"Serve Progression 2: Half-Swing (Trophy)",cat:"Skill Focus",diff:"Beginner",skill:"Serve",
    desc:"Learn the racket drop and upward swing from the trophy position.",
    tips:["Sideways stance","Racket head up","Continuous drop-to-hit"],
    youtubeId:"QiVszYWaIO0",youtubeStart:368,youtubeEnd:472,courtType:"singles",
    players:[{id:"S",x:55,y:98,color:BH.shotBlue},{id:"R",x:50,y:5,color:BH.shotRed}],
    steps:[
      {t:"move",f:[55,98],to:[55,98],c:BH.shotBlue,note:"Start in trophy position"},
      {t:"move",f:[55,98],to:[55,98],c:BH.shotBlue,note:"Drop racket behind back"},
      {t:"hit",f:[55,98],to:[50,22],c:BH.shotBlue,n:"1",shot:"serve",hitter:"S",note:"Swing up to contact"}
    ]
  },
  {
    id:"sv-toss",name:"Serve Progression 3: Add the Toss",cat:"Skill Focus",diff:"Beginner",skill:"Serve",
    desc:"Coordinate the tossing arm with the half-swing.",
    tips:["Straight arm toss","Wait for peak","Stay smooth"],
    youtubeId:"QiVszYWaIO0",youtubeStart:472,youtubeEnd:591,courtType:"singles",
    players:[{id:"S",x:56,y:68,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[56,68],to:[56,68],c:BH.shotBlue,note:"Start in trophy position"},
      {t:"move",f:[56,68],to:[56,68],c:BH.shotBlue,note:"Toss with straight arm"},
      {t:"move",f:[56,68],to:[56,68],c:BH.shotBlue,note:"Let racket drop"},
      {t:"hit",f:[56,68],to:[50,28],c:BH.shotBlue,n:"1",shot:"serve",hitter:"S",note:"Explode up at peak"}
    ]
  },
  {
    id:"sv-contact",name:"Serve Progression 4: Full Motion",cat:"Skill Focus",diff:"Intermediate",skill:"Serve",
    desc:"Integrate the takeback and toss into one smooth motion.",
    tips:["Down together / up together","Smooth trophy","Same swing as Prog 3"],
    youtubeId:"QiVszYWaIO0",youtubeStart:591,youtubeEnd:788,courtType:"singles",
    players:[{id:"S",x:55,y:98,color:BH.shotBlue},{id:"R",x:50,y:5,color:BH.shotRed}],
    steps:[
      {t:"move",f:[55,98],to:[55,98],c:BH.shotBlue,note:"Ready stance: hands together"},
      {t:"move",f:[55,98],to:[55,98],c:BH.shotBlue,note:"Down together / up together"},
      {t:"move",f:[55,98],to:[55,98],c:BH.shotBlue,note:"Hit trophy then drop"},
      {t:"hit",f:[55,98],to:[50,25],c:BH.shotBlue,n:"1",shot:"serve",hitter:"S",note:"Explode to contact"}
    ]
  },
  {
    id:"sv-placement",name:"Serve Progression 5: Leg Drive & Rhythm",cat:"Skill Focus",diff:"Intermediate",skill:"Serve",
    desc:"Add leg drive and rhythm for power and forward transfer.",
    tips:["Deep knee bend","Drive up to full extension","Land inside court"],
    youtubeId:"QiVszYWaIO0",youtubeStart:788,youtubeEnd:941,courtType:"singles",
    players:[{id:"S",x:55,y:98,color:BH.shotBlue},{id:"R",x:50,y:5,color:BH.shotRed}],
    steps:[
      {t:"move",f:[55,98],to:[55,98],c:BH.shotBlue,note:"Full motion from Prog 4"},
      {t:"move",f:[55,98],to:[55,98],c:BH.shotBlue,note:"Knees bend on toss"},
      {t:"hit",f:[55,98],to:[72,22],c:BH.shotBlue,n:"1",shot:"serve",hitter:"S",note:"Drive up + pronate"},
      {t:"move",f:[55,98],to:[55,98],c:BH.shotBlue,note:"Land inside court"}
    ]
  },
  {
    id:"fh-ball-1",name:"FH Ball Machine Drill 1",cat:"Skill Focus",diff:"Beginner",skill:"Forehand",
    desc:"Groove the first ball-machine pattern with clean contact.",
    tips:["Racquet set early","Stay balanced","Finish across body"],
    youtubeId:"nyQSDaXOCQ8",youtubeStart:51,youtubeEnd:177,courtType:"singles",
    players:[{id:"A",x:50,y:92,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[50,92],to:[50,92],c:BH.shotBlue,note:"Neutral stance, single feed"},
      {t:"hit",f:[50,92],to:[28,8],c:BH.shotBlue,n:"1",shot:"forehand",hitter:"A",note:"Steady cross-court"},
      {t:"move",f:[50,92],to:[50,92],c:BH.shotBlue,note:"Recover to center mark"}
    ]
  },
  {
    id:"fh-ball-2",name:"FH Ball Machine Drill 2",cat:"Skill Focus",diff:"Beginner",skill:"Forehand",
    desc:"Build depth control with the second ball-machine pattern.",
    tips:["High net clearance","Use legs","Recover to center"],
    youtubeId:"nyQSDaXOCQ8",youtubeStart:177,youtubeEnd:292,courtType:"singles",
    players:[{id:"A",x:60,y:92,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[60,92],to:[72,92],c:BH.shotBlue,note:"Run around BH corner"},
      {t:"hit",f:[72,92],to:[40,8],c:BH.shotBlue,n:"1",shot:"forehand",hitter:"A",note:"Inside-out FH"},
      {t:"move",f:[72,92],to:[50,92],c:BH.shotBlue,note:"Recover to center"}
    ]
  },
  {
    id:"fh-ball-3",name:"FH Ball Machine Drill 3",cat:"Skill Focus",diff:"Intermediate",skill:"Forehand",
    desc:"Use forehand patterns to handle height changes.",
    tips:["Adjust with legs","Brush up","Finish balanced"],
    youtubeId:"nyQSDaXOCQ8",youtubeStart:292,youtubeEnd:370,courtType:"singles",
    players:[{id:"A",x:50,y:90,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[50,90],to:[50,96],c:BH.shotBlue,note:"Deep ball: load back"},
      {t:"hit",f:[50,96],to:[72,8],c:BH.shotBlue,n:"1",shot:"forehand",hitter:"A",note:"Heavy topspin loop"},
      {t:"move",f:[50,96],to:[50,82],c:BH.shotBlue,note:"Short ball: step in"},
      {t:"hit",f:[50,82],to:[72,28],c:BH.shotBlue,n:"2",shot:"forehand",hitter:"A",note:"Flatten for winner"},
      {t:"move",f:[50,82],to:[50,92],c:BH.shotBlue,note:"Backpedal to center"}
    ]
  },
  {
    id:"fh-ball-4",name:"FH Ball Machine Drill 4",cat:"Skill Focus",diff:"Intermediate",skill:"Forehand",
    desc:"Attack short balls and recover quickly.",
    tips:["Explode forward","Stay low","Recover fast"],
    youtubeId:"nyQSDaXOCQ8",youtubeStart:370,youtubeEnd:492,courtType:"singles",
    players:[{id:"A",x:50,y:85,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[50,85],to:[80,86],c:BH.shotBlue,note:"Sprint wide FH"},
      {t:"hit",f:[80,86],to:[72,28],c:BH.shotBlue,n:"1",shot:"forehand",hitter:"A",note:"Open-stance on run"},
      {t:"move",f:[80,86],to:[50,85],c:BH.shotBlue,note:"Push off to recover"}
    ]
  },
  {
    id:"fh-ball-5",name:"FH Ball Machine Drill 5",cat:"Skill Focus",diff:"Intermediate",skill:"Forehand",
    desc:"Handle deep balls with heavy topspin.",
    tips:["Load on back leg","Drive up","Recover to middle"],
    youtubeId:"nyQSDaXOCQ8",youtubeStart:492,youtubeEnd:552,courtType:"singles",
    players:[{id:"A",x:50,y:92,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[50,92],to:[50,92],c:BH.shotBlue,note:"Hold ground vs high ball"},
      {t:"hit",f:[50,92],to:[50,8],c:BH.shotBlue,n:"1",shot:"forehand",hitter:"A",note:"Attack at shoulder height"},
      {t:"move",f:[50,92],to:[50,92],c:BH.shotBlue,note:"Reset quickly"}
    ]
  },
  {
    id:"fh-ball-6",name:"FH Ball Machine Drill 6: 2-1 Pattern",cat:"Skill Focus",diff:"Intermediate",skill:"Forehand",
    desc:"Pattern play: two cross-courts then change direction.",
    tips:["Rally, rally, attack","Set feet early","Change direction on ball 3"],
    youtubeId:"nyQSDaXOCQ8",youtubeStart:552,youtubeEnd:616,courtType:"singles",
    players:[{id:"A",x:50,y:92,color:BH.shotBlue}],
    steps:[
      {t:"hit",f:[50,92],to:[28,8],c:BH.shotBlue,n:"1",shot:"forehand",hitter:"A",note:"CC 1"},
      {t:"move",f:[50,92],to:[50,92],c:BH.shotBlue,note:"Recover"},
      {t:"hit",f:[50,92],to:[28,8],c:BH.shotBlue,n:"2",shot:"forehand",hitter:"A",note:"CC 2"},
      {t:"move",f:[50,92],to:[52,92],c:BH.shotBlue,note:"Set for change"},
      {t:"hit",f:[52,92],to:[72,8],c:BH.shotBlue,n:"3",shot:"forehand",hitter:"A",note:"DTL attack"}
    ]
  },
  {
    id:"fh-ball-7",name:"FH Ball Machine Drill 7: Random Reaction",cat:"Skill Focus",diff:"Intermediate",skill:"Forehand",
    desc:"React to random feeds while committing to forehands.",
    tips:["Explosive footwork","Cut off angles","Max intensity 30-45s"],
    youtubeId:"nyQSDaXOCQ8",youtubeStart:616,youtubeEnd:690,courtType:"singles",
    players:[{id:"A",x:50,y:92,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[50,92],to:[70,90],c:BH.shotBlue,note:"Explode to FH side"},
      {t:"hit",f:[70,90],to:[28,8],c:BH.shotBlue,n:"1",shot:"forehand",hitter:"A",note:"Forehand only"},
      {t:"move",f:[70,90],to:[30,90],c:BH.shotBlue,note:"Run around BH"},
      {t:"hit",f:[30,90],to:[72,10],c:BH.shotBlue,n:"2",shot:"forehand",hitter:"A",note:"Forehand only"},
      {t:"move",f:[30,90],to:[50,92],c:BH.shotBlue,note:"Reset quickly"}
    ]
  },
  {
    id:"bh-options",name:"Backhand High-Ball Options",cat:"Skill Focus",diff:"Intermediate",skill:"Backhand",
    desc:"Choose the best option when the ball rises above shoulder height.",
    tips:["Decide early","Use spacing","Commit to the choice"],
    youtubeId:"5eWB8YyIz8o",youtubeStart:30,youtubeEnd:148,courtType:"singles",
    players:[{id:"A",x:28,y:90,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[28,90],to:[42,88],c:BH.shotBlue,note:"Recognize high floater early"},
      {t:"move",f:[42,88],to:[50,86],c:BH.shotBlue,note:"Run around: clear BH side"},
      {t:"hit",f:[50,86],to:[72,10],c:BH.shotBlue,n:"1",shot:"forehand",hitter:"A",note:"Option 1: Inside-out FH"},
      {t:"move",f:[50,86],to:[28,90],c:BH.shotBlue,note:"Reset for BH option"},
      {t:"move",f:[28,90],to:[26,92],c:BH.shotBlue,note:"Slice prep: racket high"},
      {t:"hit",f:[26,92],to:[60,12],c:BH.shotBlue,n:"2",shot:"slice_bh",hitter:"A",note:"Option 2: BH slice (chop)"},
      {t:"move",f:[26,92],to:[24,92],c:BH.shotBlue,note:"Drive prep: shoulders turned"},
      {t:"hit",f:[24,92],to:[70,12],c:BH.shotBlue,n:"3",shot:"backhand",hitter:"A",note:"Option 3: High BH drive"},
      {t:"move",f:[24,92],to:[30,92],c:BH.shotBlue,note:"Recover to base"}
    ]
  },
  {
    id:"bh-technique",name:"Backhand High-Ball Technique",cat:"Skill Focus",diff:"Intermediate",skill:"Backhand",
    desc:"Key technique cues for high-ball backhands.",
    tips:["Create space","Stay tall","Finish through target"],
    youtubeId:"5eWB8YyIz8o",youtubeStart:148,youtubeEnd:183,courtType:"singles",
    players:[{id:"A",x:28,y:90,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[28,90],to:[24,92],c:BH.shotBlue,note:"Create space behind ball"},
      {t:"move",f:[24,92],to:[24,92],c:BH.shotBlue,note:"Racket high, closed stance"},
      {t:"hit",f:[24,92],to:[70,12],c:BH.shotBlue,n:"1",shot:"backhand",hitter:"A",note:"Drive level through"},
      {t:"move",f:[24,92],to:[28,90],c:BH.shotBlue,note:"Balanced finish"}
    ]
  },
  {
    id:"bh-contact",name:"Backhand Contact Point",cat:"Skill Focus",diff:"Beginner",skill:"Backhand",
    desc:"Find clean contact on high balls with a stable head.",
    tips:["Contact out in front","Stable wrist","Balanced finish"],
    youtubeId:"5eWB8YyIz8o",youtubeStart:183,youtubeEnd:211,courtType:"singles",
    players:[{id:"A",x:28,y:90,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[28,90],to:[24,92],c:BH.shotBlue,note:"Spacing: ball farther out"},
      {t:"hit",f:[24,92],to:[70,10],c:BH.shotBlue,n:"1",shot:"backhand",hitter:"A",note:"Contact at shoulder height"},
      {t:"move",f:[24,92],to:[28,90],c:BH.shotBlue,note:"Recover to base"}
    ]
  },
  {
    id:"bh-drill-1",name:"Backhand Drill 1",cat:"Skill Focus",diff:"Intermediate",skill:"Backhand",
    desc:"Use a repeatable pattern to build high-ball consistency.",
    tips:["Same rhythm","Aim big targets","Recover quickly"],
    youtubeId:"5eWB8YyIz8o",youtubeStart:211,youtubeEnd:417,courtType:"singles",
    players:[{id:"A",x:28,y:90,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[28,90],to:[26,92],c:BH.shotBlue,note:"Baseline position"},
      {t:"move",f:[26,92],to:[26,92],c:BH.shotBlue,note:"Self-drop from high hand"},
      {t:"hit",f:[26,92],to:[70,12],c:BH.shotBlue,n:"1",shot:"backhand",hitter:"A",note:"Contact at shoulder height"},
      {t:"move",f:[26,92],to:[26,92],c:BH.shotBlue,note:"Drive level (no big brush)"},
      {t:"move",f:[26,92],to:[28,90],c:BH.shotBlue,note:"Reset and repeat"}
    ]
  },
  {
    id:"bh-ball-machine",name:"Backhand Ball Machine Drills",cat:"Skill Focus",diff:"Intermediate",skill:"Backhand",
    desc:"Ball-machine sequences for high-ball backhands.",
    tips:["Move through the ball","Finish balanced","Recover to center"],
    youtubeId:"5eWB8YyIz8o",youtubeStart:417,youtubeEnd:521,courtType:"singles",
    players:[{id:"A",x:28,y:92,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[28,92],to:[28,92],c:BH.shotBlue,note:"Ready on baseline"},
      {t:"move",f:[28,92],to:[24,92],c:BH.shotBlue,note:"Split + unit turn"},
      {t:"hit",f:[24,92],to:[70,10],c:BH.shotBlue,n:"1",shot:"backhand",hitter:"A",note:"Drive at shoulder height"},
      {t:"move",f:[24,92],to:[28,92],c:BH.shotBlue,note:"Reset quickly"},
      {t:"move",f:[28,92],to:[40,88],c:BH.shotBlue,note:"Decision set: run around"},
      {t:"hit",f:[40,88],to:[72,10],c:BH.shotBlue,n:"2",shot:"forehand",hitter:"A",note:"Option 1: Inside-out FH"},
      {t:"move",f:[40,88],to:[24,92],c:BH.shotBlue,note:"Decision set: stay BH"},
      {t:"hit",f:[24,92],to:[70,12],c:BH.shotBlue,n:"3",shot:"backhand",hitter:"A",note:"Option 3: Drive"},
      {t:"move",f:[24,92],to:[26,92],c:BH.shotBlue,note:"Decision set: slice"},
      {t:"hit",f:[26,92],to:[60,12],c:BH.shotBlue,n:"4",shot:"slice_bh",hitter:"A",note:"Option 2: Slice"}
    ]
  },
  {
    id:"ret-split",name:"Return Split Step",cat:"Skill Focus",diff:"Beginner",skill:"Return",
    desc:"Time the split step to react to the serve.",
    tips:["Split as ball leaves strings","Stay low","Short first step"],
    youtubeId:"QnKKocEn77g",youtubeStart:18,youtubeEnd:60,courtType:"singles",
    players:[{id:"S",x:55,y:98,color:BH.shotBlue},{id:"R",x:50,y:5,color:BH.shotRed}],
    steps:[
      {t:"move",f:[50,5],to:[50,5],c:BH.shotRed,note:"Hop into wide base"},
      {t:"move",f:[50,5],to:[50,5],c:BH.shotRed,note:"Land on balls of feet"},
      {t:"hit",f:[55,98],to:[50,22],c:BH.shotBlue,n:"1",shot:"serve",hitter:"S"},
      {t:"hit",f:[50,5],to:[50,45],c:BH.shotRed,n:"2",shot:"forehand",hitter:"R",note:"Explode after landing"}
    ]
  },
  {
    id:"ret-timing",name:"Return Timing",cat:"Skill Focus",diff:"Beginner",skill:"Return",
    desc:"Load early and meet the ball in front.",
    tips:["Early prep","Compact swing","Eyes on contact"],
    youtubeId:"QnKKocEn77g",youtubeStart:60,youtubeEnd:91,courtType:"singles",
    players:[{id:"S",x:55,y:98,color:BH.shotBlue},{id:"R",x:50,y:5,color:BH.shotRed}],
    steps:[
      {t:"move",f:[50,5],to:[50,5],c:BH.shotRed,note:"Start forward as toss goes up"},
      {t:"move",f:[50,5],to:[50,5],c:BH.shotRed,note:"In air at contact"},
      {t:"hit",f:[55,98],to:[50,22],c:BH.shotBlue,n:"1",shot:"serve",hitter:"S"},
      {t:"hit",f:[50,5],to:[50,45],c:BH.shotRed,n:"2",shot:"backhand",hitter:"R",note:"Land then push"}
    ]
  },
  {
    id:"ret-position",name:"Return Positioning",cat:"Skill Focus",diff:"Beginner",skill:"Return",
    desc:"Adjust return position based on serve and court speed.",
    tips:["Start neutral","Adjust depth","Recover quickly"],
    youtubeId:"QnKKocEn77g",youtubeStart:91,youtubeEnd:159,courtType:"singles",
    players:[{id:"S",x:55,y:98,color:BH.shotBlue},{id:"R",x:50,y:5,color:BH.shotRed}],
    steps:[
      {t:"move",f:[50,5],to:[50,8],c:BH.shotRed,note:"Step back for 1st serve"},
      {t:"hit",f:[55,98],to:[50,22],c:BH.shotBlue,n:"1",shot:"serve",hitter:"S"},
      {t:"hit",f:[50,8],to:[50,45],c:BH.shotRed,n:"2",shot:"forehand",hitter:"R",note:"More time to react"},
      {t:"move",f:[50,8],to:[50,2],c:BH.shotRed,note:"Step in for 2nd serve"},
      {t:"hit",f:[55,98],to:[50,22],c:BH.shotBlue,n:"3",shot:"serve",hitter:"S",note:"Slower serve"},
      {t:"hit",f:[50,2],to:[50,45],c:BH.shotRed,n:"4",shot:"forehand",hitter:"R",note:"Take time away"}
    ]
  },
  {
    id:"ret-stance",name:"Return Stance",cat:"Skill Focus",diff:"Beginner",skill:"Return",
    desc:"Use an athletic stance to handle pace and direction.",
    tips:["Wide base","Hands in front","Explode to the ball"],
    youtubeId:"QnKKocEn77g",youtubeStart:159,youtubeEnd:212,courtType:"singles",
    players:[{id:"S",x:55,y:98,color:BH.shotBlue},{id:"R",x:50,y:5,color:BH.shotRed}],
    steps:[
      {t:"move",f:[50,5],to:[50,5],c:BH.shotRed,note:"Wide base + low center"},
      {t:"move",f:[50,5],to:[50,5],c:BH.shotRed,note:"Hands in front, ready"},
      {t:"hit",f:[55,98],to:[50,22],c:BH.shotBlue,n:"1",shot:"serve",hitter:"S"},
      {t:"hit",f:[50,5],to:[50,45],c:BH.shotRed,n:"2",shot:"forehand",hitter:"R",note:"Explode from stance"}
    ]
  },
  {
    id:"ret-block",name:"Block Return",cat:"Skill Focus",diff:"Intermediate",skill:"Return",
    desc:"Neutralize pace with a firm block return.",
    tips:["Short punch","Stable wrist","Aim deep middle"],
    youtubeId:"QnKKocEn77g",youtubeStart:212,youtubeEnd:257,courtType:"singles",
    players:[{id:"S",x:55,y:98,color:BH.shotBlue},{id:"R",x:50,y:5,color:BH.shotRed}],
    steps:[
      {t:"move",f:[50,5],to:[50,5],c:BH.shotRed,note:"Unit turn, compact back"},
      {t:"hit",f:[55,98],to:[50,22],c:BH.shotBlue,n:"1",shot:"serve",hitter:"S"},
      {t:"hit",f:[50,5],to:[50,45],c:BH.shotRed,n:"2",shot:"backhand",hitter:"R",note:"Block to deep middle"}
    ]
  },
  {
    id:"ret-middle",name:"Return Placement: Middle",cat:"Skill Focus",diff:"Beginner",skill:"Return",
    desc:"Use the middle for maximum margin on fast serves.",
    tips:["Aim through the center","Lowest net height","Takes away angles"],
    youtubeId:"QnKKocEn77g",youtubeStart:1234,youtubeEnd:1268,courtType:"singles",
    players:[{id:"S",x:55,y:98,color:BH.shotBlue},{id:"R",x:50,y:5,color:BH.shotRed}],
    steps:[
      {t:"hit",f:[55,98],to:[50,22],c:BH.shotBlue,n:"1",shot:"serve",hitter:"S"},
      {t:"hit",f:[50,5],to:[50,50],c:BH.shotRed,n:"2",shot:"forehand",hitter:"R",note:"Return to middle"}
    ]
  },
  {
    id:"ret-2nd-attack",name:"Second Serve Attack",cat:"Skill Focus",diff:"Beginner",skill:"Return",
    desc:"Step in and pressure the server on second serves.",
    tips:["Move 1–2m forward","Look for forehand","Big safe target"],
    youtubeId:"QnKKocEn77g",youtubeStart:1064,youtubeEnd:1159,courtType:"singles",
    players:[{id:"S",x:55,y:98,color:BH.shotBlue},{id:"R",x:50,y:5,color:BH.shotRed}],
    steps:[
      {t:"move",f:[50,5],to:[50,2],c:BH.shotRed,note:"Step in for 2nd serve"},
      {t:"move",f:[50,2],to:[62,4],c:BH.shotRed,note:"Run around to FH"},
      {t:"hit",f:[62,4],to:[50,60],c:BH.shotRed,n:"1",shot:"forehand",hitter:"R",note:"Attack big target"}
    ]
  },
  {
    id:"fw-fh-tech",name:"Footwork: FH Technique & Steps",cat:"Skill Focus",diff:"Beginner",skill:"Footwork",
    desc:"Use clean setup steps to organize the forehand.",
    tips:["Early unit turn","Small adjustment steps","Balance at contact"],
    youtubeId:"nyQSDaXOCQ8",youtubeStart:33,youtubeEnd:124,courtType:"singles",
    players:[{id:"A",x:50,y:92,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[50,92],to:[50,92],c:BH.shotBlue,note:"Split step + unit turn"},
      {t:"move",f:[50,92],to:[58,90],c:BH.shotBlue,note:"Small adjustment steps"},
      {t:"hit",f:[58,90],to:[72,12],c:BH.shotBlue,n:"1",shot:"forehand",hitter:"A",note:"Set then strike"},
      {t:"move",f:[58,90],to:[50,92],c:BH.shotBlue,note:"Recover to center"}
    ]
  },
  {
    id:"fw-self-feed",name:"Footwork: Self-Feed Rhythm",cat:"Skill Focus",diff:"Beginner",skill:"Footwork",
    desc:"Self-feed to control spacing and rhythm before striking.",
    tips:["Feed to the hitting zone","Set feet early","Balance through contact"],
    youtubeId:"R5w7dnZmC18",youtubeStart:61,youtubeEnd:97,courtType:"singles",
    players:[{id:"A",x:50,y:92,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[50,92],to:[50,92],c:BH.shotBlue,note:"Stand baseline or service line"},
      {t:"move",f:[50,92],to:[50,92],c:BH.shotBlue,note:"Hold ball out front"},
      {t:"move",f:[50,92],to:[50,92],c:BH.shotBlue,note:"Drop (no toss), 1 bounce"},
      {t:"hit",f:[50,92],to:[72,12],c:BH.shotBlue,n:"1",shot:"forehand",hitter:"A",note:"Swing right after bounce"},
      {t:"move",f:[50,92],to:[50,92],c:BH.shotBlue,note:"Head still, watch contact"}
    ]
  },
  {
    id:"fw-stance",name:"Footwork: Stance Training",cat:"Skill Focus",diff:"Beginner",skill:"Footwork",
    desc:"Choose open vs. neutral stance under control.",
    tips:["Lower center of gravity","Stay athletic","Recover to center"],
    youtubeId:"R5w7dnZmC18",youtubeStart:129,youtubeEnd:212,courtType:"singles",
    players:[{id:"A",x:50,y:92,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[50,92],to:[46,92],c:BH.shotBlue,note:"Neutral: step in"},
      {t:"hit",f:[46,92],to:[72,12],c:BH.shotBlue,n:"1",shot:"forehand",hitter:"A",note:"Neutral stance rep"},
      {t:"move",f:[46,92],to:[54,92],c:BH.shotBlue,note:"Open: load outside leg"},
      {t:"hit",f:[54,92],to:[72,12],c:BH.shotBlue,n:"2",shot:"forehand",hitter:"A",note:"Open stance rep"},
      {t:"move",f:[54,92],to:[50,92],c:BH.shotBlue,note:"Alternate 5/5 reps"}
    ]
  },
  {
    id:"fw-footwork",name:"Footwork: Movement Patterns",cat:"Skill Focus",diff:"Beginner",skill:"Footwork",
    desc:"Lateral and diagonal movement patterns to the ball.",
    tips:["Stay low","Short steps","Explode to ball"],
    youtubeId:"R5w7dnZmC18",youtubeStart:213,youtubeEnd:272,courtType:"singles",
    players:[{id:"A",x:50,y:92,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[50,92],to:[62,84],c:BH.shotBlue,note:"Sprint diagonally to ball"},
      {t:"hit",f:[62,84],to:[72,12],c:BH.shotBlue,n:"1",shot:"forehand",hitter:"A",note:"Self-feed + strike"},
      {t:"move",f:[62,84],to:[50,92],c:BH.shotBlue,note:"Shuffle/backpedal to center"},
      {t:"move",f:[50,92],to:[38,84],c:BH.shotBlue,note:"Repeat to BH side"}
    ]
  },
  {
    id:"fw-low-balls",name:"Footwork: Low-Ball Movement",cat:"Skill Focus",diff:"Intermediate",skill:"Footwork",
    desc:"Get under low balls with strong leg drive.",
    tips:["Bend knees","Keep chest up","Drive through contact"],
    youtubeId:"R5w7dnZmC18",youtubeStart:273,youtubeEnd:306,courtType:"singles",
    players:[{id:"A",x:50,y:92,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[50,92],to:[50,86],c:BH.shotBlue,note:"Low feed near feet"},
      {t:"move",f:[50,86],to:[50,86],c:BH.shotBlue,note:"Bend knees (not back)"},
      {t:"hit",f:[50,86],to:[72,22],c:BH.shotBlue,n:"1",shot:"forehand",hitter:"A",note:"Brush up for dip"},
      {t:"move",f:[50,86],to:[50,70],c:BH.shotBlue,note:"Follow ball forward"}
    ]
  },
  {
    id:"tr-midcourt-attack",name:"Transition: Midcourt Attack",cat:"Skill Focus",diff:"Intermediate",skill:"Transition/Approach",
    desc:"Attack midcourt balls and move forward.",
    tips:["Explode forward","Stay balanced","Recover to net"],
    youtubeId:"R5w7dnZmC18",youtubeStart:307,youtubeEnd:398,courtType:"singles",
    players:[{id:"A",x:50,y:85,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[50,85],to:[50,96],c:BH.shotBlue,note:"Start 2m behind baseline"},
      {t:"move",f:[50,96],to:[50,88],c:BH.shotBlue,note:"Toss short ball forward"},
      {t:"hit",f:[50,88],to:[72,28],c:BH.shotBlue,n:"1",shot:"forehand",hitter:"A",note:"Hit at top of bounce"},
      {t:"move",f:[50,88],to:[50,60],c:BH.shotBlue,note:"Carry momentum inside"}
    ]
  },
  {
    id:"tr-abcd",name:"Transition: ABCD Combos",cat:"Skill Focus",diff:"Intermediate",skill:"Transition/Approach",
    desc:"Build point patterns from midcourt with ABCD combos.",
    tips:["Play with margin","Finish forward","Recover quickly"],
    youtubeId:"R5w7dnZmC18",youtubeStart:399,youtubeEnd:428,courtType:"singles",
    players:[{id:"A",x:50,y:85,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[50,85],to:[50,85],c:BH.shotBlue,note:"Call target A/B/C/D"},
      {t:"hit",f:[50,85],to:[72,28],c:BH.shotBlue,n:"1",shot:"forehand",hitter:"A",note:"Hit called target"},
      {t:"move",f:[50,85],to:[50,85],c:BH.shotBlue,note:"Miss = restart set"}
    ]
  },
  {
    id:"tr-tactic-game",name:"Transition: Tactics Game",cat:"Skill Focus",diff:"Intermediate",skill:"Transition/Approach",
    desc:"Play transition points with a tactical constraint.",
    tips:["Commit to the plan","Attack the short ball","Recover to net"],
    youtubeId:"R5w7dnZmC18",youtubeStart:429,youtubeEnd:492,courtType:"singles",
    players:[{id:"A",x:50,y:85,color:BH.shotBlue},{id:"B",x:50,y:15,color:BH.shotRed}],
    steps:[
      {t:"move",f:[50,85],to:[50,85],c:BH.shotBlue,note:"Serve or self-feed start"},
      {t:"move",f:[50,85],to:[62,72],c:BH.shotBlue,note:"Shadow return to spot"},
      {t:"hit",f:[62,72],to:[72,28],c:BH.shotBlue,n:"1",shot:"forehand",hitter:"A",note:"Approach shot"},
      {t:"move",f:[62,72],to:[50,50],c:BH.shotBlue,note:"Move in + split step"}
    ]
  },
  {
    id:"pt-x-drill",name:"Pattern: X-Drill (Zone B/C)",cat:"Skill Focus",diff:"Intermediate",skill:"Patterns",
    desc:"Crossing pattern in the middle to build consistency.",
    tips:["Aim big middle targets","Recover after each hit","Stay patient"],
    youtubeId:"a-KsAAdIxP0",youtubeStart:198,youtubeEnd:272,courtType:"singles",
    players:[{id:"A",x:50,y:90,color:BH.shotBlue},{id:"B",x:50,y:10,color:BH.shotRed}],
    steps:[
      {t:"hit",f:[50,90],to:[42,10],c:BH.shotBlue,n:"1",shot:"forehand",hitter:"A",note:"CC to safe target"},
      {t:"hit",f:[50,10],to:[58,90],c:BH.shotRed,n:"2",shot:"forehand",hitter:"B",note:"CC back"},
      {t:"move",f:[50,90],to:[50,90],c:BH.shotBlue,note:"Recover to center"},
      {t:"move",f:[50,10],to:[50,10],c:BH.shotRed,note:"Recover to center"}
    ]
  },
  {
    id:"pt-warmup",name:"Pattern: Middle Warm-Up",cat:"Skill Focus",diff:"Beginner",skill:"Patterns",
    desc:"Warm-up in the middle to control depth and shape.",
    tips:["Heavy spin","Aim to the middle","Recover to center"],
    youtubeId:"a-KsAAdIxP0",youtubeStart:229,youtubeEnd:272,courtType:"singles",
    players:[{id:"A",x:50,y:90,color:BH.shotBlue},{id:"B",x:50,y:10,color:BH.shotRed}],
    steps:[
      {t:"hit",f:[50,90],to:[50,10],c:BH.shotBlue,n:"1",shot:"forehand",hitter:"A",note:"Middle target"},
      {t:"hit",f:[50,10],to:[50,90],c:BH.shotRed,n:"2",shot:"forehand",hitter:"B",note:"Middle target"},
      {t:"move",f:[50,90],to:[50,90],c:BH.shotBlue,note:"Recover to middle"},
      {t:"move",f:[50,10],to:[50,10],c:BH.shotRed,note:"Recover to middle"}
    ]
  },
  {
    id:"pt-middle",name:"Pattern: Play Middle (Zone B/C)",cat:"Skill Focus",diff:"Intermediate",skill:"Patterns",
    desc:"Neutralize points by playing through the middle.",
    tips:["Avoid the sidelines","Use height","Be consistent"],
    youtubeId:"a-KsAAdIxP0",youtubeStart:272,youtubeEnd:404,courtType:"singles",
    players:[{id:"A",x:50,y:90,color:BH.shotBlue},{id:"B",x:50,y:10,color:BH.shotRed}],
    steps:[
      {t:"hit",f:[50,90],to:[50,10],c:BH.shotBlue,n:"1",shot:"forehand",hitter:"A",note:"Zone B/C only"},
      {t:"hit",f:[50,10],to:[50,90],c:BH.shotRed,n:"2",shot:"forehand",hitter:"B",note:"Zone B/C only"},
      {t:"move",f:[50,90],to:[50,90],c:BH.shotBlue,note:"Patience + margin"},
      {t:"move",f:[50,10],to:[50,10],c:BH.shotRed,note:"Patience + margin"}
    ]
  },
  {
    id:"pt-attack-short",name:"Pattern: Attack the Short Ball",cat:"Skill Focus",diff:"Intermediate",skill:"Patterns",
    desc:"Rally middle until a short ball appears, then attack the corners.",
    tips:["B/C until short","Step in aggressively","Finish to A or D"],
    youtubeId:"a-KsAAdIxP0",youtubeStart:404,youtubeEnd:472,courtType:"singles",
    players:[{id:"A",x:50,y:90,color:BH.shotBlue},{id:"B",x:50,y:10,color:BH.shotRed}],
    steps:[
      {t:"hit",f:[50,90],to:[50,12],c:BH.shotBlue,n:"1",shot:"forehand",hitter:"A",note:"Rally middle"},
      {t:"hit",f:[50,12],to:[50,85],c:BH.shotRed,n:"2",shot:"forehand",hitter:"B",note:"Short ball"},
      {t:"move",f:[50,90],to:[50,78],c:BH.shotBlue,note:"Step in"},
      {t:"hit",f:[50,78],to:[72,12],c:BH.shotBlue,n:"3",shot:"forehand",hitter:"A",note:"Attack corner"}
    ]
  },
  {
    id:"df-high-ball",name:"Defense: High-Ball Options",cat:"Skill Focus",diff:"Intermediate",skill:"Defense",
    desc:"Defend high balls with smart shot selection.",
    tips:["Create spacing","Stay tall","Reset the point"],
    youtubeId:"5eWB8YyIz8o",youtubeStart:30,youtubeEnd:148,courtType:"singles",
    players:[{id:"A",x:28,y:90,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[28,90],to:[24,92],c:BH.shotBlue,note:"Back up for space"},
      {t:"hit",f:[24,92],to:[50,12],c:BH.shotBlue,n:"1",shot:"slice_bh",hitter:"A",note:"Deep slice reset"},
      {t:"move",f:[24,92],to:[28,90],c:BH.shotBlue,note:"Recover to middle"}
    ]
  },
  {
    id:"df-block-return",name:"Defense: Block Return",cat:"Skill Focus",diff:"Intermediate",skill:"Defense",
    desc:"Use a block return to neutralize pace.",
    tips:["Compact swing","Firm wrist","Aim deep middle"],
    youtubeId:"QnKKocEn77g",youtubeStart:212,youtubeEnd:257,courtType:"singles",
    players:[{id:"S",x:55,y:98,color:BH.shotBlue},{id:"R",x:50,y:5,color:BH.shotRed}],
    steps:[
      {t:"move",f:[50,5],to:[50,5],c:BH.shotRed,note:"Short backswing"},
      {t:"hit",f:[55,98],to:[50,22],c:BH.shotBlue,n:"1",shot:"serve",hitter:"S"},
      {t:"hit",f:[50,5],to:[50,45],c:BH.shotRed,n:"2",shot:"backhand",hitter:"R",note:"Block to middle"}
    ]
  },
  {
    id:"df-slice-lob",name:"Defense: Slice Lob",cat:"Skill Focus",diff:"Intermediate",skill:"Defense",
    desc:"Use the slice lob to reset under pressure.",
    tips:["Open face","High arc","Recover quickly"],
    youtubeId:"Y8-_g03MEVs",youtubeStart:42,youtubeEnd:130,courtType:"singles",
    players:[{id:"A",x:50,y:85,color:BH.shotBlue},{id:"B",x:50,y:15,color:BH.shotRed}],
    steps:[
      {t:"move",f:[50,85],to:[50,85],c:BH.shotBlue,note:"Continental grip"},
      {t:"hit",f:[50,85],to:[50,15],c:BH.shotBlue,n:"1",shot:"slice_fh",hitter:"A",note:"High-to-low-to-high"},
      {t:"move",f:[50,85],to:[50,70],c:BH.shotBlue,note:"Recover to middle"}
    ]
  },
  {
    id:"sl-fh-lob",name:"Slice: FH Slice Lob",cat:"Skill Focus",diff:"Intermediate",skill:"Slice",
    desc:"Forehand slice lob technique and contact.",
    tips:["Open face","Brush under","High finish"],
    youtubeId:"Y8-_g03MEVs",youtubeStart:52,youtubeEnd:130,courtType:"singles",
    players:[{id:"A",x:50,y:85,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[50,85],to:[50,85],c:BH.shotBlue,note:"Open face, racket high"},
      {t:"hit",f:[50,85],to:[50,15],c:BH.shotBlue,n:"1",shot:"slice_fh",hitter:"A",note:"Squash + lift"},
      {t:"move",f:[50,85],to:[50,85],c:BH.shotBlue,note:"Finish high"}
    ]
  },
  {
    id:"sl-bh-lob",name:"Slice: BH Slice Lob",cat:"Skill Focus",diff:"Intermediate",skill:"Slice",
    desc:"Backhand slice lob mechanics and shape.",
    tips:["Stable wrist","High arc","Recover to middle"],
    youtubeId:"Y8-_g03MEVs",youtubeStart:214,youtubeEnd:249,courtType:"singles",
    players:[{id:"A",x:28,y:85,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[28,85],to:[28,85],c:BH.shotBlue,note:"Chip forward + up"},
      {t:"hit",f:[28,85],to:[72,15],c:BH.shotBlue,n:"1",shot:"slice_bh",hitter:"A",note:"Lift with open face"},
      {t:"move",f:[28,85],to:[28,85],c:BH.shotBlue,note:"Aim over BH shoulder"}
    ]
  },
  {
    id:"sl-stance",name:"Slice: Stance & Setup",cat:"Skill Focus",diff:"Beginner",skill:"Slice",
    desc:"Use the right stance to control slice height and depth.",
    tips:["Side-on stance","Stay low","Finish forward"],
    youtubeId:"Y8-_g03MEVs",youtubeStart:244,youtubeEnd:281,courtType:"singles",
    players:[{id:"A",x:28,y:85,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[28,85],to:[28,85],c:BH.shotBlue,note:"Side-on stance"},
      {t:"hit",f:[28,85],to:[72,15],c:BH.shotBlue,n:"1",shot:"slice_bh",hitter:"A",note:"Forward + up swing"},
      {t:"move",f:[28,85],to:[28,85],c:BH.shotBlue,note:"Finish high"}
    ]
  },
  {
    id:"lob-fh-topspin",name:"Lobs: Forehand Topspin",cat:"Skill Focus",diff:"Intermediate",skill:"Lobs",
    desc:"Lift the forehand topspin lob for defense and reset.",
    tips:["Brush up","Aim high","Recover quickly"],
    youtubeId:"4ybMXpEr5hg",youtubeStart:34,youtubeEnd:236,courtType:"singles",
    players:[{id:"A",x:50,y:85,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[50,85],to:[50,85],c:BH.shotBlue,note:"Disguise like pass"},
      {t:"hit",f:[50,85],to:[50,10],c:BH.shotBlue,n:"1",shot:"forehand",hitter:"A",note:"Brush straight up"},
      {t:"move",f:[50,85],to:[50,85],c:BH.shotBlue,note:"Snap wrist upward"}
    ]
  },
  {
    id:"lob-one-hand",name:"Lobs: One-Handed",cat:"Skill Focus",diff:"Intermediate",skill:"Lobs",
    desc:"One-handed topspin lob technique.",
    tips:["High finish","Use legs","Keep balance"],
    youtubeId:"4ybMXpEr5hg",youtubeStart:236,youtubeEnd:382,courtType:"singles",
    players:[{id:"A",x:28,y:85,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[28,85],to:[28,85],c:BH.shotBlue,note:"Drop racket low"},
      {t:"hit",f:[28,85],to:[50,10],c:BH.shotBlue,n:"1",shot:"forehand",hitter:"A",note:"Flick up to sky"},
      {t:"move",f:[28,85],to:[28,85],c:BH.shotBlue,note:"Finish high, balanced"}
    ]
  },
  {
    id:"lob-two-hand",name:"Lobs: Two-Handed",cat:"Skill Focus",diff:"Intermediate",skill:"Lobs",
    desc:"Two-handed topspin lob technique.",
    tips:["Drive up","Aim deep","Recover fast"],
    youtubeId:"4ybMXpEr5hg",youtubeStart:382,youtubeEnd:432,courtType:"singles",
    players:[{id:"A",x:28,y:85,color:BH.shotBlue}],
    steps:[
      {t:"move",f:[28,85],to:[28,85],c:BH.shotBlue,note:"Load legs + left hand"},
      {t:"hit",f:[28,85],to:[50,10],c:BH.shotBlue,n:"1",shot:"backhand",hitter:"A",note:"Scoop up with non-dom"},
      {t:"move",f:[28,85],to:[28,85],c:BH.shotBlue,note:"Recover quickly"}
    ]
  }
];
const DRILL_CATS=["All",...Array.from(new Set(DRILLS.map(d=>d.cat)))];
const DRILL_SKILLS=["All",...Array.from(new Set(DRILLS.map(d=>d.skill).filter(Boolean)))];


// === court.js ===
// Court Components for Belmont Hill Tennis Training Web App
// Loaded via <script type="text/babel"> - uses global variables from data.js

/**
 * Shot Type Abbreviations & Colors
 * Used as badges on player markers, Sportplan-style
 */
const SHOT_INFO = {
  forehand:  { abbr: "FH", icon: "→" },
  backhand:  { abbr: "BH", icon: "←" },
  serve:     { abbr: "SV", icon: "↑" },
  fh_volley: { abbr: "FV", icon: "⤴" },
  bh_volley: { abbr: "BV", icon: "⤵" },
  overhead:  { abbr: "OH", icon: "⬆" },
  slice_fh:  { abbr: "SF", icon: "↗" },
  slice_bh:  { abbr: "SB", icon: "↖" },
};

/**
 * PlayerIcon Component — Sportplan-style clean marker
 *
 * Design: Colored circle with player letter in center,
 * small shot-type badge offset to the side when active.
 * Clean, readable on iPad screens at any size.
 */
function PlayerIcon({px, py, color, label, shot, courtY}) {
  const isFar = courtY < 50;
  const info = shot ? SHOT_INFO[shot] : null;

  // Main circle radius
  const r = 16;
  // Badge offset direction (show badge toward center of court for readability)
  const badgeX = 14;
  const badgeY = isFar ? 14 : -14;

  return (
    <g style={{transform:`translate(${px}px,${py}px)`, transition:"transform 0.4s ease-in-out"}}>
      {/* Drop shadow for depth */}
      <circle cx={1} cy={2} r={r} fill="rgba(0,0,0,0.25)"/>

      {/* Main player circle */}
      <circle cx={0} cy={0} r={r} fill={color} stroke={BH.white} strokeWidth={2.5}/>

      {/* Player label (letter) centered */}
      <text x={0} y={1} textAnchor="middle" dominantBaseline="middle"
            fontSize="14" fontWeight="900" fill={BH.white}
            style={{letterSpacing:"0.5px"}}>{label}</text>

      {/* Shot-type badge when active */}
      {info && (
        <g>
          <rect x={badgeX - 13} y={badgeY - 7} width={26} height={14}
                rx={3} fill={BH.navy} stroke={BH.white} strokeWidth={1.2}/>
          <text x={badgeX} y={badgeY + 1} textAnchor="middle" dominantBaseline="middle"
                fontSize="8" fontWeight="bold" fill={BH.white}
                style={{letterSpacing:"0.5px"}}>{info.abbr}</text>
        </g>
      )}

      {/* Direction indicator - small arrow showing facing direction */}
      {!info && (
        <g>
          {isFar ? (
            <polygon points="-4,-20 4,-20 0,-25" fill={color} stroke={BH.white} strokeWidth={1} opacity={0.7}/>
          ) : (
            <polygon points="-4,20 4,20 0,25" fill={color} stroke={BH.white} strokeWidth={1} opacity={0.7}/>
          )}
        </g>
      )}
    </g>
  );
}

/**
 * Court Component
 * Renders full tennis court SVG with white lines, service boxes, net, and overlays
 * Displays shot arrows and player icons
 * Now includes smooth animated transitions via SVG <animate> elements
 */
function Court({courtType, players, steps, activeStep, showAll}) {
  const L = CRT.PAD, R = CRT.W - CRT.PAD, T = CRT.PAD, B = CRT.H - CRT.PAD;

  // Filter visible steps
  const vis = steps.filter((_, i) => showAll || i <= activeStep);

  // Find the active hitter and their shot for PlayerIcon rendering
  const activeS = steps[activeStep];
  const hId = activeS && activeS.t === "hit" ? activeS.hitter : null;
  const hShot = activeS ? activeS.shot : null;

  // Arrow rendering function
  function arrow(s, i) {
    const x1 = mX(s.f[0]), y1 = mY(s.f[1]);
    const x2 = mX(s.to[0]), y2 = mY(s.to[1]);
    const isActive = i === activeStep;
    const op = isActive ? 1 : 0.35;
    const sw = isActive ? 3 : 1.8;
    const col = s.c || BH.shotBlue;
    const dashArr = s.t === "move" ? "6,4" : "none";
    const markerId = `ah${i}`;

    return (
      <g key={i} opacity={op} style={{transition:"opacity 0.3s ease"}}>
        <defs>
          <marker id={markerId} markerWidth="10" markerHeight="8" refX="9" refY="4" orient="auto">
            <path d="M0,0 L10,4 L0,8 Z" fill={col}/>
          </marker>
        </defs>
        <line x1={x1} y1={y1} x2={x2} y2={y2} stroke={col} strokeWidth={sw}
              markerEnd={`url(#${markerId})`} strokeDasharray={dashArr}/>
        {/* Step number badge on arrow midpoint */}
        {s.t === "hit" && s.n && (
          <g>
            <circle cx={(x1+x2)/2} cy={(y1+y2)/2} r={10} fill={BH.navy} stroke={BH.white} strokeWidth={1.5}/>
            <text x={(x1+x2)/2} y={(y1+y2)/2+1} textAnchor="middle" dominantBaseline="middle"
                  fontSize="9" fontWeight="bold" fill={BH.white}>{s.n}</text>
          </g>
        )}
        {/* Note label on active arrow */}
        {s.note && isActive && (
          <text x={(x1+x2)/2} y={(y1+y2)/2 - 16} textAnchor="middle"
                fontSize="9" fontWeight="bold" fill={BH.navy}
                stroke={BH.white} strokeWidth={3} paintOrder="stroke">{s.note}</text>
        )}
      </g>
    );
  }

  return (
    <svg viewBox={`0 0 ${CRT.W} ${CRT.H}`}
         style={{width:"100%", maxWidth:360, background:BH.courtDark, borderRadius:12}}>
      {/* Court surface */}
      <rect x={L} y={T} width={R-L} height={B-T} fill={BH.courtGreen} rx={2}/>

      {/* Court outline - white */}
      <rect x={L} y={T} width={R-L} height={B-T} fill="none" stroke={BH.white} strokeWidth={2}/>

      {/* Singles sidelines */}
      <line x1={SL.l} y1={T} x2={SL.l} y2={B} stroke={BH.white} strokeWidth={1.5}/>
      <line x1={SL.r} y1={T} x2={SL.r} y2={B} stroke={BH.white} strokeWidth={1.5}/>

      {/* Service box lines */}
      <line x1={SL.l} y1={SVC.far} x2={SL.r} y2={SVC.far} stroke={BH.white} strokeWidth={1.5}/>
      <line x1={SL.l} y1={SVC.near} x2={SL.r} y2={SVC.near} stroke={BH.white} strokeWidth={1.5}/>

      {/* Center service line */}
      <line x1={mX(50)} y1={SVC.far} x2={mX(50)} y2={SVC.near} stroke={BH.white} strokeWidth={1.5}/>

      {/* Center marks at baselines */}
      <line x1={mX(50)} y1={T} x2={mX(50)} y2={T+12} stroke={BH.white} strokeWidth={1.5}/>
      <line x1={mX(50)} y1={B} x2={mX(50)} y2={B-12} stroke={BH.white} strokeWidth={1.5}/>

      {/* Net with posts */}
      <line x1={L-8} y1={NET_Y} x2={R+8} y2={NET_Y} stroke={BH.white} strokeWidth={3}/>
      <line x1={L-8} y1={NET_Y} x2={L-8} y2={NET_Y-8} stroke={BH.white} strokeWidth={2}/>
      <line x1={R+8} y1={NET_Y} x2={R+8} y2={NET_Y-8} stroke={BH.white} strokeWidth={2}/>

      {/* Shot arrows */}
      {vis.map((s, i) => arrow(s, i))}

      {/* Player icons */}
      {players.map(p => (
        <PlayerIcon key={p.id}
          px={mX(p.x)} py={mY(p.y)}
          color={p.color} label={p.id}
          shot={p.id === hId ? hShot : null}
          courtY={p.y}/>
      ))}
    </svg>
  );
}


// === circuit.js ===
/**
 * Circuit Training Components
 * Belmont Hill Tennis Training Web App
 *
 * Components:
 * - CircuitRing: Circular station layout
 * - CircuitTimer: Compact horizontal countdown timer with state machine
 */

/**
 * CircuitRing Component
 * Renders stations in a circle with dynamic sizing based on number of stations
 * All stations are same color (navy). Selected station gets subtle highlight.
 */
function CircuitRing({stations, selectedIdx, onSelect, onRemove}) {
  const n = stations.length;
  if (n === 0) return (
    <div style={{textAlign:"center", padding:"60px 20px", color:BH.g500, fontSize:"15px"}}>
      Select exercises to build your circuit
    </div>
  );

  const size = Math.max(320, Math.min(520, (typeof window !== "undefined" ? window.innerWidth : 520) - 40));
  const padY = size * 0.08;
  const width = size;
  const height = size + padY * 2;
  const cx = width / 2, cy = height / 2;
  const rad = size * 0.385;
  const nr = size * 0.092;
  const fs = size < 420 ? 10 : 11;

  // Helper to wrap text into multiple lines
  function wrapText(text, maxLen) {
    const words = text.split(" ");
    const lines = [];
    let currentLine = "";
    for (const word of words) {
      if ((currentLine + " " + word).trim().length <= maxLen) {
        currentLine = currentLine ? currentLine + " " + word : word;
      } else {
        if (currentLine) lines.push(currentLine);
        currentLine = word;
      }
    }
    if (currentLine) lines.push(currentLine);
    return lines;
  }

  return (
    <svg width={width} height={height} style={{display:"block", margin:"0 auto", maxWidth:"100%"}}>
      {/* Connecting ring */}
      <circle cx={cx} cy={cy} r={rad} fill="none" stroke={BH.g300} strokeWidth={1} strokeDasharray="4,3"/>

      {/* Center label */}
      <text x={cx} y={cy-6} textAnchor="middle" fontSize="13" fontWeight="bold" fill={BH.navy}>CIRCUIT</text>
      <text x={cx} y={cy+10} textAnchor="middle" fontSize="11" fill={BH.g500}>{n} stations</text>

      {/* Station nodes */}
      {stations.map((s, i) => {
        const ang = (i / n) * Math.PI * 2 - Math.PI / 2;
        const x = cx + rad * Math.cos(ang);
        const y = cy + rad * Math.sin(ang);
        const isSelected = i === selectedIdx;

        // All stations are navy, selected gets gold border
        const fillCol = BH.navy;
        const strokeCol = isSelected ? BH.maroon : BH.g400;
        const strokeW = isSelected ? 3 : 1.5;

        // Wrap exercise name
        const lines = wrapText(s.name, 10);
        const stationNum = String(i + 1);

        return (
          <g key={s.id} style={{cursor: onSelect ? "pointer" : "default"}}
             onClick={() => onSelect && onSelect(i)}>
            <circle cx={x} cy={y} r={nr} fill={fillCol} stroke={strokeCol} strokeWidth={strokeW}/>

            {/* Station number above */}
            <text x={x} y={y - nr - 12} textAnchor="middle" fontSize="12" fontWeight="bold"
                  fill={BH.navy} style={{pointerEvents:"none", paintOrder:"stroke", stroke:BH.white, strokeWidth:3}}>
              {stationNum}
            </text>

            {/* Exercise name, wrapped */}
            {lines.length === 1 && (
              <text x={x} y={y + 2} textAnchor="middle" dominantBaseline="middle"
                    fontSize={fs} fontWeight="bold" fill={BH.white}
                    style={{pointerEvents:"none"}}>{lines[0]}</text>
            )}
            {lines.length === 2 && (
              <>
                <text x={x} y={y - 4} textAnchor="middle" dominantBaseline="middle"
                      fontSize={fs} fontWeight="bold" fill={BH.white}
                      style={{pointerEvents:"none"}}>{lines[0]}</text>
                <text x={x} y={y + 8} textAnchor="middle" dominantBaseline="middle"
                      fontSize={fs} fontWeight="bold" fill={BH.white}
                      style={{pointerEvents:"none"}}>{lines[1]}</text>
              </>
            )}
            {lines.length >= 3 && (
              <>
                <text x={x} y={y - 8} textAnchor="middle" dominantBaseline="middle"
                      fontSize={fs} fontWeight="bold" fill={BH.white}
                      style={{pointerEvents:"none"}}>{lines[0]}</text>
                <text x={x} y={y + 2} textAnchor="middle" dominantBaseline="middle"
                      fontSize={fs} fontWeight="bold" fill={BH.white}
                      style={{pointerEvents:"none"}}>{lines[1]}</text>
                <text x={x} y={y + 12} textAnchor="middle" dominantBaseline="middle"
                      fontSize={fs} fontWeight="bold" fill={BH.white}
                      style={{pointerEvents:"none"}}>{lines[2]}</text>
              </>
            )}

            {/* Reps/sets info below */}
            <text x={x} y={y + nr + 12} textAnchor="middle" fontSize="9"
                  fill={BH.g500} style={{pointerEvents:"none"}}>{s.reps || ""}</text>

            {/* Remove button (admin only) */}
            {onRemove && (
              <g style={{cursor:"pointer"}}
                 onClick={(e) => { e.stopPropagation(); onRemove(i); }}>
                <circle cx={x + nr * 0.7} cy={y - nr * 0.7} r={10}
                        fill={BH.shotRed || "#E74C3C"} stroke={BH.white} strokeWidth={1.5}/>
                <text x={x + nr * 0.7} y={y - nr * 0.7 + 1} textAnchor="middle"
                      dominantBaseline="middle" fontSize="13" fontWeight="bold"
                      fill={BH.white} style={{pointerEvents:"none"}}>×</text>
              </g>
            )}
          </g>
        );
      })}
    </svg>
  );
}

/**
 * CircuitTimer Component
 * Compact horizontal countdown timer with state machine for circuit training
 * States: idle → station → rest → (loop) or done
 * Renders as a compact toolbar-style timer bar (~70px height)
 */
function CircuitTimer({work, rest, rounds, exercises, onStation, onPhaseInfo, session, isAdmin, onAdminStart, onAdminPause, onAdminResume, onAdminReset}) {
  const [phase, setPhase] = React.useState("idle");  // idle, station, rest, pausedStation, pausedRest, done
  const [time, setTime] = React.useState(0);
  const [stIdx, setStIdx] = React.useState(0);
  const [round, setRound] = React.useState(1);
  const timerRef = React.useRef(null);
  const [nowTs, setNowTs] = React.useState(Date.now());

  const totalStations = exercises.length;
  const dur = phase === "station" || phase === "pausedStation" ? work : phase === "rest" || phase === "pausedRest" ? rest : 0;
  const sessionMode = !!session;

  function deriveFromSession() {
    if (!session || totalStations <= 0 || rounds <= 0) {
      return { phase: "idle", remaining: 0, round: 1, stIdx: 0 };
    }
    const status = session.status || "idle";
    if (status === "idle" || !session.start_time) {
      return { phase: "idle", remaining: 0, round: 1, stIdx: 0 };
    }
    const elapsed = status === "paused"
      ? (session.elapsed_at_pause || 0)
      : Math.max(0, Math.floor((nowTs - Date.parse(session.start_time)) / 1000));
    const unit = work + rest;
    const totalStationsAll = totalStations * rounds;
    const totalDuration = totalStationsAll > 0 ? (totalStationsAll - 1) * unit + work : 0;
    if (elapsed >= totalDuration) {
      return { phase: "done", remaining: 0, round: rounds, stIdx: totalStations - 1 };
    }
    let blockIndex = 0;
    let timeInBlock = elapsed;
    if (totalStationsAll > 1) {
      const lastStart = (totalStationsAll - 1) * unit;
      if (elapsed >= lastStart) {
        blockIndex = totalStationsAll - 1;
        timeInBlock = elapsed - lastStart;
      } else {
        blockIndex = Math.floor(elapsed / unit);
        timeInBlock = elapsed % unit;
      }
    }
    const st = blockIndex % totalStations;
    const rd = Math.floor(blockIndex / totalStations) + 1;
    const isWork = timeInBlock < work;
    const rem = isWork ? (work - timeInBlock) : (unit - timeInBlock);
    let ph = isWork ? "station" : "rest";
    if (status === "paused") ph = ph === "station" ? "pausedStation" : "pausedRest";
    return { phase: ph, remaining: rem, round: rd, stIdx: st };
  }

  const derived = sessionMode ? deriveFromSession() : null;

  // Reset everything when exercises change (local mode only)
  React.useEffect(() => {
    if (sessionMode) return;
    if (timerRef.current) clearInterval(timerRef.current);
    timerRef.current = null;
    setPhase("idle");
    setTime(0);
    setStIdx(0);
    setRound(1);
  }, [exercises.length, sessionMode]);

  // Expose phase info to parent
  React.useEffect(() => {
    if (onPhaseInfo) {
      onPhaseInfo({
        phase: sessionMode ? derived.phase : phase,
        time: sessionMode ? (dur - derived.remaining) : time,
        round: sessionMode ? derived.round : round,
        stIdx: sessionMode ? derived.stIdx : stIdx,
        remaining: sessionMode ? derived.remaining : Math.max(0, dur - time),
        totalStations,
        rounds
      });
    }
  }, [phase, time, round, stIdx, dur, totalStations, rounds, onPhaseInfo, sessionMode, derived]);

  const tick = React.useCallback(() => {
    setTime(t => {
      if (t + 1 >= dur) {
        // Time's up for this phase
        if (phase === "station") {
          // Check if last station in round
          setStIdx(si => {
            if (si + 1 >= totalStations) {
              // End of round
              setRound(r => {
                if (r >= rounds) {
                  // All done!
                  setPhase("done");
                  snd.done();
                  if (timerRef.current) clearInterval(timerRef.current);
                  timerRef.current = null;
                  return r;
                }
                // Next round - go to rest
                snd.rest();
                setPhase("rest");
                return r;
              });
              return si;
            }
            // Next station, but rest first
            snd.rest();
            setPhase("rest");
            return si;
          });
        } else if (phase === "rest") {
          // Move to next station
          setStIdx(si => {
            let nextSi = si + 1;
            if (nextSi >= totalStations) {
              // New round
              nextSi = 0;
              setRound(r => r + 1);
            }
            if (onStation) onStation(nextSi);
            return nextSi;
          });
          snd.go();
          setPhase("station");
        }
        return 0;
      }
      // 3-second warning ticks
      if (dur - (t + 1) <= 3 && dur - (t + 1) > 0) snd.tick();
      return t + 1;
    });
  }, [phase, dur, totalStations, rounds, onStation]);

  // Run timer (local mode only)
  React.useEffect(() => {
    if (sessionMode) return;
    if (phase === "station" || phase === "rest") {
      timerRef.current = setInterval(tick, 1000);
      return () => {
        if (timerRef.current) clearInterval(timerRef.current);
      };
    }
  }, [phase, tick, sessionMode]);

  // Tick clock for session mode
  React.useEffect(() => {
    if (!sessionMode) return;
    if (!session || session.status !== "running") return;
    const t = setInterval(() => setNowTs(Date.now()), 1000);
    return () => clearInterval(t);
  }, [sessionMode, session && session.status]);

  // Sync selection for session mode
  React.useEffect(() => {
    if (!sessionMode || !onStation || !derived) return;
    onStation(derived.stIdx);
  }, [sessionMode, derived && derived.stIdx, onStation]);

  function start() {
    setPhase("station");
    setTime(0);
    setStIdx(0);
    setRound(1);
    if (onStation) onStation(0);
    snd.go();
  }

  function pause() {
    if (timerRef.current) clearInterval(timerRef.current);
    timerRef.current = null;
    setPhase(p => p === "station" ? "pausedStation" : p === "rest" ? "pausedRest" : p);
  }

  function resume() {
    setPhase(p => p === "pausedStation" ? "station" : p === "pausedRest" ? "rest" : p);
  }

  function reset() {
    if (timerRef.current) clearInterval(timerRef.current);
    timerRef.current = null;
    setPhase("idle");
    setTime(0);
    setStIdx(0);
    setRound(1);
    if (onStation) onStation(-1);
  }

  const effectivePhase = sessionMode ? derived.phase : phase;
  const remaining = sessionMode ? derived.remaining : Math.max(0, dur - time);
  const isRunning = effectivePhase === "station" || effectivePhase === "rest";
  const isPaused = effectivePhase === "pausedStation" || effectivePhase === "pausedRest";
  const isWork = effectivePhase === "station" || effectivePhase === "pausedStation";
  const col = isWork ? BH.shotBlue : BH.shotGold;

  return (
    <div style={{
      display: "flex",
      alignItems: "center",
      gap: "16px",
      padding: "8px 16px",
      background: BH.g100,
      borderRadius: "8px",
      minHeight: "70px",
      fontSize: "14px",
      fontFamily: "system-ui, -apple-system, sans-serif"
    }}>
      {/* Countdown number - big and bold */}
      <div style={{
        fontSize: "42px",
        fontWeight: "bold",
        color: effectivePhase === "idle" ? BH.g400 : col,
        minWidth: "80px",
        textAlign: "center",
        fontVariantNumeric: "tabular-nums"
      }}>
        {effectivePhase === "idle" ? "—" : effectivePhase === "done" ? "✓" : remaining}
      </div>

      {/* Divider */}
      <div style={{width: "1px", height: "50px", background: BH.g300}} />

      {/* Phase label and info */}
      <div style={{flex: 1}}>
        {effectivePhase === "idle" && (
          <div style={{color: BH.g500, fontSize: "13px"}}>
            {isAdmin ? "Ready to start" : "Waiting for coach..."}
          </div>
        )}
        {effectivePhase === "done" && (
          <div style={{fontWeight: "bold", color: BH.maroon}}>CIRCUIT COMPLETE!</div>
        )}
        {(effectivePhase === "station" || effectivePhase === "pausedStation") && (
          <>
            <div style={{fontWeight: "bold", color: BH.shotBlue, marginBottom: "2px"}}>WORK</div>
            <div style={{fontSize: "12px", color: BH.g500}}>
              Round {sessionMode ? derived.round : round}/{rounds} • Station {(sessionMode ? derived.stIdx : stIdx) + 1}/{totalStations}
            </div>
          </>
        )}
        {(effectivePhase === "rest" || effectivePhase === "pausedRest") && (
          <>
            <div style={{fontWeight: "bold", color: BH.shotGold, marginBottom: "2px"}}>REST</div>
            <div style={{fontSize: "12px", color: BH.g500}}>
              Round {sessionMode ? derived.round : round}/{rounds} • Next: Station {((sessionMode ? derived.stIdx : stIdx) + 1) % totalStations + 1}
            </div>
          </>
        )}
      </div>

      {/* Control buttons */}
      <div style={{display: "flex", gap: "8px", flexWrap: "wrap", justifyContent: "flex-end"}}>
        {effectivePhase === "idle" && (
          <button onClick={sessionMode ? onAdminStart : start} disabled={sessionMode && !isAdmin} style={{
            padding: "8px 12px",
            background: BH.shotBlue,
            color: BH.white,
            border: "none",
            borderRadius: "4px",
            cursor: sessionMode && !isAdmin ? "not-allowed" : "pointer",
            fontSize: "13px",
            fontWeight: "bold",
            whiteSpace: "nowrap",
            opacity: sessionMode && !isAdmin ? 0.5 : 1
          }}>
            START
          </button>
        )}
        {isRunning && (
          <button onClick={sessionMode ? onAdminPause : pause} disabled={sessionMode && !isAdmin} style={{
            padding: "8px 12px",
            background: BH.shotGold,
            color: BH.navy,
            border: "none",
            borderRadius: "4px",
            cursor: sessionMode && !isAdmin ? "not-allowed" : "pointer",
            fontSize: "13px",
            fontWeight: "bold",
            whiteSpace: "nowrap",
            opacity: sessionMode && !isAdmin ? 0.5 : 1
          }}>
            PAUSE
          </button>
        )}
        {isPaused && (
          <button onClick={sessionMode ? onAdminResume : resume} disabled={sessionMode && !isAdmin} style={{
            padding: "8px 12px",
            background: BH.shotBlue,
            color: BH.white,
            border: "none",
            borderRadius: "4px",
            cursor: sessionMode && !isAdmin ? "not-allowed" : "pointer",
            fontSize: "13px",
            fontWeight: "bold",
            whiteSpace: "nowrap",
            opacity: sessionMode && !isAdmin ? 0.5 : 1
          }}>
            RESUME
          </button>
        )}
        {(isRunning || isPaused || effectivePhase === "done") && (
          <button onClick={sessionMode ? onAdminReset : reset} disabled={sessionMode && !isAdmin} style={{
            padding: "8px 12px",
            background: BH.g400,
            color: BH.white,
            border: "none",
            borderRadius: "4px",
            cursor: sessionMode && !isAdmin ? "not-allowed" : "pointer",
            fontSize: "13px",
            fontWeight: "bold",
            whiteSpace: "nowrap",
            opacity: sessionMode && !isAdmin ? 0.5 : 1
          }}>
            RESET
          </button>
        )}
      </div>
    </div>
  );
}


// === app.js ===
// DrillViewer Component
function DrillViewer({drill}) {
  const [step, setStep] = React.useState(-1);
  const [playing, setPlaying] = React.useState(false);
  const [showAll, setShowAll] = React.useState(false);
  const tmr = React.useRef(null);

  // Reset when drill changes
  React.useEffect(() => {
    setStep(-1);
    setPlaying(false);
    setShowAll(false);
  }, [drill && drill.id]);

  // Auto-play timer
  React.useEffect(() => {
    if (!playing || !drill) return;
    tmr.current = setInterval(() => {
      setStep(s => {
        if (s >= drill.steps.length - 1) {
          setPlaying(false);
          return s;
        }
        return s + 1;
      });
    }, 1200);
    return () => clearInterval(tmr.current);
  }, [playing, drill]);

  if (!drill) return null;
  const steps = drill.steps || [];
  const maxStep = steps.length - 1;

  // Button style helper
  const btn = (bg, small) => ({
    padding: small ? "6px 10px" : "8px 14px",
    background: bg,
    color: BH.white,
    border: "none",
    borderRadius: "6px",
    cursor: "pointer",
    fontSize: small ? "12px" : "13px",
    fontWeight: "bold",
    flex: small ? undefined : 1,
  });

  return (
    <div style={{display:"flex", flexDirection:"column", gap:"12px"}}>
      {/* Court visualization */}
      <Court
        courtType={drill.courtType}
        players={drill.players}
        steps={steps}
        activeStep={step}
        showAll={showAll}
      />

      {/* Step counter */}
      <div style={{textAlign:"center", fontSize:"13px", color:BH.g700, fontWeight:"bold"}}>
        Step {Math.max(0, step) + 1} / {steps.length}
        {showAll && <span style={{color:BH.maroon, marginLeft:"8px"}}>(All visible)</span>}
      </div>

      {/* Playback controls */}
      <div style={{display:"flex", gap:"6px", flexWrap:"wrap", justifyContent:"center"}}>
        <button onClick={() => { setStep(-1); setPlaying(false); setShowAll(false); }} style={btn(BH.g500)}>
          Reset
        </button>
        <button onClick={() => setStep(s => Math.max(-1, s - 1))} style={btn(BH.navy)}
                disabled={step <= -1}>
          ← Back
        </button>
        <button onClick={() => {
          if (playing) { setPlaying(false); }
          else { if (step >= maxStep) setStep(-1); setPlaying(true); }
        }} style={btn(playing ? BH.shotRed : BH.shotBlue)}>
          {playing ? "⏸ Pause" : "▶ Play"}
        </button>
        <button onClick={() => setStep(s => Math.min(maxStep, s + 1))} style={btn(BH.navy)}
                disabled={step >= maxStep}>
          Next →
        </button>
        <button onClick={() => { setShowAll(!showAll); setStep(maxStep); }} style={btn(BH.maroon)}>
          {showAll ? "Step View" : "Show All"}
        </button>
      </div>

      {/* Step-by-step breakdown */}
      <div style={{background:BH.white, padding:"12px 16px", borderRadius:"8px", border:`1px solid ${BH.g300}`}}>
        <div style={{fontSize:"12px", fontWeight:"bold", color:BH.navy, marginBottom:"8px"}}>
          Step Breakdown
        </div>
        {steps.map((s, i) => {
          const isActive = i === step;
          const isPast = i < step;
          const desc = s.t === "hit"
            ? `${s.hitter} hits ${(s.shot||"").replace(/_/g," ")}${s.note ? " — "+s.note : ""}`
            : `Player moves${s.note ? " — "+s.note : " to position"}`;
          return (
            <div key={i} style={{
              padding:"6px 10px", marginBottom:"2px", borderRadius:"4px", fontSize:"12px",
              display:"flex", gap:"8px", alignItems:"center",
              background: isActive ? BH.maroon : "transparent",
              color: isActive ? BH.white : isPast ? BH.g400 : BH.g700,
              fontWeight: isActive ? "bold" : "normal",
              transition: "all 0.2s"
            }}>
              <span style={{minWidth:"20px", fontWeight:"bold", color: isActive ? BH.white : BH.g400}}>
                {s.t === "hit" ? s.n : "·"}
              </span>
              <span>{desc}</span>
            </div>
          );
        })}
      </div>

      {/* Coaching tips */}
      {drill.tips && drill.tips.length > 0 && (
        <div style={{background:BH.white, padding:"14px 16px", borderRadius:"8px", border:`1px solid ${BH.g300}`}}>
          <div style={{fontSize:"12px", fontWeight:"bold", color:BH.navy, marginBottom:"6px"}}>
            Coaching Tips
          </div>
          <ul style={{margin:0, paddingLeft:"18px", fontSize:"12px", color:BH.g700, lineHeight:"1.7"}}>
            {drill.tips.map((t, i) => <li key={i}>{t}</li>)}
          </ul>
        </div>
      )}

      {/* YouTube embed with timestamp support */}
      {drill.youtubeId && (
        <div style={{borderRadius:"8px", overflow:"hidden", border:`1px solid ${BH.g300}`}}>
          <div style={{padding:"8px 12px", background:BH.navy, display:"flex", alignItems:"center", gap:"8px"}}>
            <span style={{fontSize:"12px", fontWeight:"bold", color:BH.white}}>Video Demo</span>
            {(drill.youtubeStart || drill.youtubeEnd) && (
              <span style={{fontSize:"10px", color:BH.maroon, opacity:0.8}}>
                {drill.youtubeStart ? `from ${Math.floor(drill.youtubeStart/60)}:${String(drill.youtubeStart%60).padStart(2,"0")}` : ""}
                {drill.youtubeEnd ? ` to ${Math.floor(drill.youtubeEnd/60)}:${String(drill.youtubeEnd%60).padStart(2,"0")}` : ""}
              </span>
            )}
          </div>
          <div style={{position:"relative", paddingBottom:"56.25%", height:0, overflow:"hidden"}}>
            <iframe
              src={`https://www.youtube.com/embed/${drill.youtubeId}?${drill.youtubeStart ? "start="+drill.youtubeStart : ""}${drill.youtubeEnd ? "&end="+drill.youtubeEnd : ""}&rel=0&modestbranding=1`}
              frameBorder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope"
              allowFullScreen style={{position:"absolute", top:0, left:0, width:"100%", height:"100%"}}/>
          </div>
        </div>
      )}
    </div>
  );
}

// DrillTimer Component
function DrillTimer({duration, resetKey, onNext, canNext, isAdmin, session, onAdminStart, onAdminPause, onAdminResume, onAdminReset}) {
  const [running, setRunning] = React.useState(false);
  const [timeLeft, setTimeLeft] = React.useState(duration);
  const tmr = React.useRef(null);

  React.useEffect(() => {
    setRunning(false);
    setTimeLeft(duration);
    if (tmr.current) clearInterval(tmr.current);
    tmr.current = null;
  }, [duration, resetKey]);

  const sessionMode = !!session;
  const getStatus = () => session ? session.status : null;
  const getStart = () => session ? session.start_time : null;
  const getElapsedAtPause = () => session ? (session.elapsed_at_pause || 0) : 0;
  const getDuration = () => {
    const d = session && typeof session.duration === "number" ? session.duration : duration;
    return Math.max(1, Number(d) || 0);
  };
  const computeSharedTimeLeft = () => {
    const status = getStatus();
    const dur = getDuration();
    if (!status) return dur;
    if (status === "idle") return dur;
    if (status === "paused") return Math.max(0, dur - getElapsedAtPause());
    const start = getStart();
    if (!start) return dur;
    const elapsed = Math.max(0, Math.floor((Date.now() - Date.parse(start)) / 1000));
    return Math.max(0, dur - elapsed);
  };

  React.useEffect(() => {
    if (sessionMode) {
      setTimeLeft(computeSharedTimeLeft());
      tmr.current = setInterval(() => {
        setTimeLeft(computeSharedTimeLeft());
      }, 1000);
      return () => { if (tmr.current) clearInterval(tmr.current); };
    }
    if (!running) {
      if (tmr.current) clearInterval(tmr.current);
      tmr.current = null;
      return;
    }
    tmr.current = setInterval(() => {
      setTimeLeft(t => {
        if (t <= 1) {
          setRunning(false);
          if (tmr.current) clearInterval(tmr.current);
          tmr.current = null;
          try { snd.done(); } catch(e) {}
          return 0;
        }
        return t - 1;
      });
    }, 1000);
    return () => { if (tmr.current) clearInterval(tmr.current); };
  }, [running, sessionMode, session && session.status, session && session.start_time, session && session.elapsed_at_pause, session && session.duration]);

  const mm = String(Math.floor(timeLeft / 60)).padStart(2, "0");
  const ss = String(timeLeft % 60).padStart(2, "0");

  const btn = (bg) => ({
    padding:"8px 12px",
    background:bg,
    color:BH.white,
    border:"none",
    borderRadius:"6px",
    cursor:"pointer",
    fontSize:"12px",
    fontWeight:"bold"
  });

  const status = sessionMode ? getStatus() : null;
  const canAdmin = isAdmin && (!sessionMode || !!session);
  const startLabel = status === "running" ? "Pause" : status === "paused" ? "Resume" : "Start";

  const statusText = sessionMode
    ? (status === "running" ? "Coach is running the timer" : status === "paused" ? "Paused by coach" : "Waiting for coach...")
    : "";

  return (
    <div style={{background:BH.white, border:`1px solid ${BH.g300}`, borderRadius:"8px", padding:"12px 14px", marginBottom:"10px"}}>
      <div style={{display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:"8px", gap:"8px"}}>
        <div style={{fontSize:"12px", fontWeight:"bold", color:BH.navy}}>Drill Timer</div>
        <div style={{fontSize:"18px", fontWeight:"bold", color:BH.maroon}}>{mm}:{ss}</div>
      </div>
      {isAdmin ? (
        <div style={{display:"flex", gap:"8px", flexWrap:"wrap"}}>
          {sessionMode ? (
            <>
              <button
                onClick={() => {
                  if (!canAdmin) return;
                  if (status === "running") onAdminPause();
                  else if (status === "paused") onAdminResume();
                  else onAdminStart();
                }}
                disabled={!canAdmin}
                style={{...btn(status === "running" ? BH.shotRed : BH.shotBlue), cursor:canAdmin ? "pointer" : "not-allowed", opacity:canAdmin ? 1 : 0.6}}>
                {startLabel}
              </button>
              <button onClick={() => { if (canAdmin) onAdminReset(); }} disabled={!canAdmin}
                style={{...btn(BH.g500), cursor:canAdmin ? "pointer" : "not-allowed", opacity:canAdmin ? 1 : 0.6}}>Reset</button>
            </>
          ) : (
            <>
              <button onClick={() => { if (isAdmin) setRunning(r => !r); }} disabled={!isAdmin}
                style={{...btn(running ? BH.shotRed : BH.shotBlue), cursor:isAdmin ? "pointer" : "not-allowed", opacity:isAdmin ? 1 : 0.6}}>
                {running ? "Pause" : "Start"}
              </button>
              <button onClick={() => { if (isAdmin) setTimeLeft(duration); }} disabled={!isAdmin}
                style={{...btn(BH.g500), cursor:isAdmin ? "pointer" : "not-allowed", opacity:isAdmin ? 1 : 0.6}}>Reset</button>
              <button onClick={() => { if (isAdmin) setTimeLeft(t => t + 30); }} disabled={!isAdmin}
                style={{...btn(BH.navy), cursor:isAdmin ? "pointer" : "not-allowed", opacity:isAdmin ? 1 : 0.6}}>+30s</button>
            </>
          )}
          <button onClick={onNext} disabled={!canNext} style={{
            ...btn(canNext ? BH.maroon : BH.g300),
            cursor: canNext ? "pointer" : "not-allowed"
          }}>Next Drill</button>
        </div>
      ) : (
        <div style={{fontSize:"12px", color:BH.g600}}>{statusText}</div>
      )}
    </div>
  );
}

// StretchTimer Component
function StretchTimer({
  label,
  color,
  session,
  kind,
  isAdmin,
  onAdminStart,
  onAdminPause,
  onAdminResume,
  onAdminReset,
  list,
  work,
  rest,
  onWorkChange,
  onRestChange
}) {
  const [tick, setTick] = React.useState(0);
  const tmr = React.useRef(null);

  const getStatus = () => session ? session[`${kind}_status`] : "idle";
  const getStart = () => session ? session[`${kind}_start_time`] : null;
  const getElapsedAtPause = () => session ? (session[`${kind}_elapsed_at_pause`] || 0) : 0;
  const getElapsed = () => {
    const status = getStatus();
    if (status === "paused") return getElapsedAtPause();
    if (status !== "running") return 0;
    const start = getStart();
    if (!start) return 0;
    return Math.max(0, Math.floor((Date.now() - Date.parse(start)) / 1000));
  };

  React.useEffect(() => {
    if (!session) return;
    setTick(t => t + 1);
    tmr.current = setInterval(() => setTick(t => t + 1), 1000);
    return () => { if (tmr.current) clearInterval(tmr.current); };
  }, [session]);

  const safeWork = Math.max(5, Number(work) || 0);
  const safeRest = Math.max(0, Number(rest) || 0);
  const safeList = Array.isArray(list) ? list.filter(Boolean) : [];
  const count = safeList.length;
  const per = safeWork + safeRest;
  const total = count > 0 ? (count * safeWork + Math.max(0, count - 1) * safeRest) : 0;
  const elapsed = Math.min(getElapsed(), total);

  let idx = -1;
  let phase = "idle";
  let timeLeft = safeWork;
  let title = "No stretches selected";
  if (count > 0) {
    if (elapsed >= total) {
      idx = count - 1;
      phase = "done";
      timeLeft = 0;
      title = "Complete";
    } else {
      idx = Math.min(count - 1, Math.floor(elapsed / per));
      const cycleStart = idx * per;
      const cyclePos = Math.max(0, elapsed - cycleStart);
      if (idx === count - 1) {
        if (cyclePos < safeWork) {
          phase = "stretch";
          timeLeft = safeWork - cyclePos;
          title = safeList[idx].name;
        } else {
          phase = "done";
          timeLeft = 0;
          title = "Complete";
        }
      } else {
        if (cyclePos < safeWork) {
          phase = "stretch";
          timeLeft = safeWork - cyclePos;
          title = safeList[idx].name;
        } else {
          phase = "rest";
          timeLeft = safeRest - (cyclePos - safeWork);
          title = "Rest";
        }
      }
    }
  }

  const mm = String(Math.floor(timeLeft / 60)).padStart(2, "0");
  const ss = String(Math.floor(timeLeft % 60)).padStart(2, "0");
  const btn = (bg) => ({
    padding:"8px 12px",
    background:bg,
    color:BH.white,
    border:"none",
    borderRadius:"6px",
    cursor:"pointer",
    fontSize:"12px",
    fontWeight:"bold"
  });

  const status = getStatus();
  const canAdmin = isAdmin && !!session;
  const startLabel = status === "running" ? "Pause" : status === "paused" ? "Resume" : "Start";
  const sub = phase === "rest" ? `Rest ${safeRest}s` : phase === "done" ? "Done" : `Stretch ${safeWork}s`;
  const statusText = status === "running" ? "Coach is running the timer" : status === "paused" ? "Paused by coach" : "Waiting for coach...";

  return (
    <div style={{background:BH.white, border:`1px solid ${BH.g300}`, borderRadius:"8px", padding:"12px 14px"}}>
      <div style={{display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:"6px", gap:"8px"}}>
        <div style={{fontSize:"12px", fontWeight:"bold", color:BH.navy}}>{label}</div>
        <div style={{fontSize:"18px", fontWeight:"bold", color:color}}>{mm}:{ss}</div>
      </div>
      <div style={{fontSize:"12px", color:BH.g700, marginBottom:"8px"}}>
        {title}{count > 0 ? ` • ${idx + 1}/${count}` : ""} • {sub}
      </div>
      {isAdmin ? (
        <div style={{display:"flex", gap:"8px", flexWrap:"wrap"}}>
          <button
            onClick={() => {
              if (!canAdmin) return;
              if (status === "running") onAdminPause();
              else if (status === "paused") onAdminResume();
              else onAdminStart();
            }}
            disabled={!canAdmin || count === 0}
            style={{
              ...btn(status === "running" ? BH.shotRed : BH.shotBlue),
              cursor: canAdmin ? "pointer" : "not-allowed",
              opacity: canAdmin && count > 0 ? 1 : 0.6
            }}>
            {startLabel}
          </button>
          <button onClick={() => { if (canAdmin) onAdminReset(); }} disabled={!canAdmin} style={{
            ...btn(BH.g500),
            cursor: canAdmin ? "pointer" : "not-allowed",
            opacity: canAdmin ? 1 : 0.6
          }}>Reset</button>
        </div>
      ) : (
        <div style={{fontSize:"12px", color:BH.g600}}>{statusText}</div>
      )}
      {isAdmin ? (
        <div style={{marginTop:"10px", display:"flex", gap:"10px", flexWrap:"wrap"}}>
          <label style={{fontSize:"11px", color:BH.g700, display:"flex", alignItems:"center", gap:"6px"}}>
            Stretch (sec)
            <input type="number" value={work} onChange={onWorkChange}
              style={{width:"64px", padding:"4px 6px", border:`1px solid ${BH.g300}`, borderRadius:"4px"}} min="5" max="1800"/>
          </label>
          <label style={{fontSize:"11px", color:BH.g700, display:"flex", alignItems:"center", gap:"6px"}}>
            Rest (sec)
            <input type="number" value={rest} onChange={onRestChange}
              style={{width:"64px", padding:"4px 6px", border:`1px solid ${BH.g300}`, borderRadius:"4px"}} min="0" max="300"/>
          </label>
        </div>
      ) : (
        <div style={{marginTop:"8px", fontSize:"11px", color:BH.g600}}>
          Stretch {safeWork}s • Rest {safeRest}s
        </div>
      )}
    </div>
  );
}

// LoginModal Component (Supabase email/password)
function LoginModal({onLogin, onClose}) {
  const [email, setEmail] = React.useState("");
  const [pw, setPw] = React.useState("");
  const [err, setErr] = React.useState("");

  const handleLogin = async () => {
    setErr("");
    const e = email.trim().toLowerCase();
    if (!e || !pw) { setErr("Enter email and password"); return; }
    const ok = await onLogin(e, pw);
    if (!ok) setErr("Invalid credentials or not authorized");
  };

  return (
    <div style={{position:"fixed", top:0, left:0, right:0, bottom:0, background:"rgba(0,0,0,0.5)",
                 display:"flex", alignItems:"center", justifyContent:"center", zIndex:1000}}>
      <div style={{background:BH.white, padding:"32px", borderRadius:"12px", width:"100%", maxWidth:"360px",
                   boxShadow:"0 10px 40px rgba(0,0,0,0.2)"}}>
        <div style={{textAlign:"center", marginBottom:"20px"}}>
          <div style={{fontSize:"20px", fontWeight:"bold", color:BH.navy}}>Admin Login</div>
          <div style={{fontSize:"12px", color:BH.g500, marginTop:"4px"}}>Belmont Hill Tennis</div>
        </div>
        <input type="email" placeholder="Email" value={email} onChange={e => setEmail(e.target.value)}
          style={{width:"100%", padding:"10px 12px", marginBottom:"12px", border:`1px solid ${BH.g300}`,
                  borderRadius:"6px", fontSize:"14px", boxSizing:"border-box"}}
          onKeyDown={e => e.key === "Enter" && handleLogin()}/>
        <input type="password" placeholder="Password" value={pw} onChange={e => setPw(e.target.value)}
          style={{width:"100%", padding:"10px 12px", marginBottom:"12px", border:`1px solid ${BH.g300}`,
                  borderRadius:"6px", fontSize:"14px", boxSizing:"border-box"}}
          onKeyDown={e => e.key === "Enter" && handleLogin()}/>
        {err && <div style={{color:BH.shotRed, fontSize:"12px", marginBottom:"12px", textAlign:"center"}}>{err}</div>}
        <div style={{display:"flex", gap:"8px"}}>
          <button onClick={handleLogin} style={{flex:1, padding:"10px", background:BH.navy, color:BH.white,
            border:"none", borderRadius:"6px", cursor:"pointer", fontWeight:"bold", fontSize:"14px"}}>Login</button>
          <button onClick={onClose} style={{flex:1, padding:"10px", background:BH.g300, color:BH.navy,
            border:"none", borderRadius:"6px", cursor:"pointer", fontSize:"14px"}}>Cancel</button>
        </div>
      </div>
    </div>
  );
}

// App Component
function App() {
  const ADMIN_EMAILS = [
    "palandjian@belmonthill.org",
    "speer@belmonthill.org",
    "markham@belmonthill.org"
  ];
  const SUPABASE_URL = "https://uievqtckkotplvyfqshu.supabase.co";
  const SUPABASE_ANON_KEY = "sb_publishable_8YcUvmNO3QWfFqOnqMKcdg_y_-L2QRg";
  const sb = React.useMemo(() => (window.supabase ? window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY) : null), []);
  const sbRest = async (path, opts = {}) => {
    const headers = Object.assign({
      apikey: SUPABASE_ANON_KEY,
      Authorization: `Bearer ${SUPABASE_ANON_KEY}`,
      "Content-Type": "application/json",
      Accept: "application/json"
    }, opts.headers || {});
    const res = await fetch(`${SUPABASE_URL}/rest/v1/${path}`, Object.assign({}, opts, { headers }));
    return res;
  };

  const [tab, setTab] = React.useState("circuits");
  const [user, setUser] = React.useState(null);
  const [showLogin, setShowLogin] = React.useState(false);
  const [drillTime, setDrillTime] = React.useState(90);
  const [isMobile, setIsMobile] = React.useState(window.innerWidth < 900);
  const [isSmall, setIsSmall] = React.useState(window.innerWidth < 768);
  const [session, setSession] = React.useState(null);
  const [sessionReady, setSessionReady] = React.useState(false);
  const [drillSession, setDrillSession] = React.useState(null);
  const [drillReady, setDrillReady] = React.useState(false);
  const [stretchSession, setStretchSession] = React.useState(null);
  const [stretchReady, setStretchReady] = React.useState(false);

  // Published plan state
  const [pubDrills, setPubDrills] = React.useState([]);
  const [pubExercises, setPubExercises] = React.useState([]);
  const [pubStretches, setPubStretches] = React.useState([]);
  const [work, setWork] = React.useState(45);
  const [rest, setRest] = React.useState(15);
  const [rounds, setRounds] = React.useState(3);

  // Admin selection state
  const [selDrills, setSelDrills] = React.useState([]);
  const [selExercises, setSelExercises] = React.useState([]);
  const [selStretches, setSelStretches] = React.useState([]);

  // UI state
  const [drSkill, setDrSkill] = React.useState("All");
  const [exCat, setExCat] = React.useState("All");
  const [stretchType, setStretchType] = React.useState("All");
  const [dynStretchTime, setDynStretchTime] = React.useState(30);
  const [dynStretchRest, setDynStretchRest] = React.useState(5);
  const [statStretchTime, setStatStretchTime] = React.useState(20);
  const [statStretchRest, setStatStretchRest] = React.useState(5);
  const [viewDrill, setViewDrill] = React.useState(null);
  const [toast, setToast] = React.useState("");
  const [circuitStIdx, setCircuitStIdx] = React.useState(-1);
  const [stretchTick, setStretchTick] = React.useState(0);
  const [circuitManualUntil, setCircuitManualUntil] = React.useState(0);

  // Sync stretch durations from session
  React.useEffect(() => {
    if (!stretchSession) return;
    if (typeof stretchSession.dyn_duration === "number") setDynStretchTime(Math.max(5, stretchSession.dyn_duration));
    if (typeof stretchSession.dyn_rest === "number") setDynStretchRest(Math.max(0, stretchSession.dyn_rest));
    if (typeof stretchSession.stat_duration === "number") setStatStretchTime(Math.max(5, stretchSession.stat_duration));
    if (typeof stretchSession.stat_rest === "number") setStatStretchRest(Math.max(0, stretchSession.stat_rest));
  }, [stretchSession]);

  // Keep shared drill session in sync with admin selection/time
  React.useEffect(() => {
    if (!sb || !admin) return;
    if (!viewDrill) return;
    const dur = Math.max(1, Number(currentDrillTimeSafe) || 0);
    updateDrillRow({ drill_id: viewDrill, duration: dur });
  }, [sb, admin, viewDrill, currentDrillTimeSafe]);

  // Keep non-admin drill selection in sync with shared drill session
  React.useEffect(() => {
    if (!drillSession) return;
    if (admin) return;
    if (drillSession.drill_id) setViewDrill(drillSession.drill_id);
  }, [drillSession, admin]);

  // Tick while any stretch timer is running so highlights stay in sync
  React.useEffect(() => {
    if (!stretchSession) return;
    const dynRunning = stretchSession.dyn_status === "running";
    const statRunning = stretchSession.stat_status === "running";
    if (!dynRunning && !statRunning) return;
    const t = setInterval(() => setStretchTick(v => v + 1), 1000);
    return () => clearInterval(t);
  }, [stretchSession && stretchSession.dyn_status, stretchSession && stretchSession.stat_status, stretchSession && stretchSession.dyn_start_time, stretchSession && stretchSession.stat_start_time]);

  // Load config on mount
  React.useEffect(() => {
    let cfg = null;
    const h = window.location.hash.substring(1);
    if (h.startsWith("config=")) {
      try { cfg = JSON.parse(atob(h.slice(7))); } catch(e) {}
    }
    const normalizeDrills = (drills, defaultTime) => {
      if (!Array.isArray(drills)) return [];
      if (drills.length === 0) return [];
      if (typeof drills[0] === "string") {
        return drills.map(id => ({ id, time: defaultTime || 90 }));
      }
      return drills.map(d => ({
        id: d.id,
        time: typeof d.time === "number" ? d.time : (defaultTime || 90)
      }));
    };
    const applyCfg = (c) => {
      if (!c) return;
      const defaultTime = c.drillTime || 90;
      const normDrills = normalizeDrills(c.drills || [], defaultTime);
      setPubDrills(normDrills);
      setPubExercises(c.exercises || []);
      setPubStretches(c.stretches || []);
      setSelDrills(normDrills);
      setSelExercises(c.exercises || []);
      setSelStretches(c.stretches || []);
      setWork(c.work || 45);
      setRest(c.rest || 15);
      setRounds(c.rounds || 3);
      setDrillTime(defaultTime);
      if (typeof c.dynStretchTime === "number") setDynStretchTime(c.dynStretchTime);
      if (typeof c.dynStretchRest === "number") setDynStretchRest(c.dynStretchRest);
      if (typeof c.statStretchTime === "number") setStatStretchTime(c.statStretchTime);
      if (typeof c.statStretchRest === "number") setStatStretchRest(c.statStretchRest);
    };
    const loadFromSupabase = async () => {
      const res = await sbRest("published_plan?select=data&id=eq.1", { method: "GET" });
      if (!res.ok) return null;
      const rows = await res.json();
      if (!rows || !rows[0] || !rows[0].data) return null;
      return rows[0].data;
    };
    if (cfg) {
      applyCfg(cfg);
    } else {
      (async () => {
        const sbCfg = await loadFromSupabase();
        if (sbCfg) {
          applyCfg(sbCfg);
        } else {
          const lc = localStorage.getItem("bh-tennis-published");
          if (lc) {
            try { applyCfg(JSON.parse(lc)); } catch(e) {}
          }
        }
      })();
    }
  }, []);

  const admin = !!(user && ADMIN_EMAILS.includes((user.email || "").toLowerCase()));

  // Auth state
  React.useEffect(() => {
    let active = true;
    if (!sb) return;
    sb.auth.getSession().then(({ data }) => {
      if (active) setUser(data && data.session ? data.session.user : null);
    });
    const { data: sub } = sb.auth.onAuthStateChange((_event, session) => {
      setUser(session ? session.user : null);
    });
    return () => {
      active = false;
      if (sub && sub.subscription) sub.subscription.unsubscribe();
    };
  }, [sb]);

  // Load circuit session + subscribe to realtime
  React.useEffect(() => {
    let channel = null;
    if (!sb) return;
    const loadSession = async () => {
      const { data, error } = await sb.from("circuit_session").select("*").eq("id", 1).single();
      if (!error) setSession(data);
      setSessionReady(true);
    };
    loadSession();
    channel = sb.channel("circuit_session")
      .on("postgres_changes", { event: "*", schema: "public", table: "circuit_session", filter: "id=eq.1" }, (payload) => {
        if (payload.new) setSession(payload.new);
      })
      .subscribe();
    return () => {
      if (channel) sb.removeChannel(channel);
    };
  }, [sb]);

  // Load drill session + subscribe to realtime
  React.useEffect(() => {
    let channel = null;
    if (!sb) return;
    const loadDrillSession = async () => {
      const { data, error } = await sb.from("drill_session").select("*").eq("id", 1).single();
      if (!error) setDrillSession(data);
      setDrillReady(true);
    };
    loadDrillSession();
    channel = sb.channel("drill_session")
      .on("postgres_changes", { event: "*", schema: "public", table: "drill_session", filter: "id=eq.1" }, (payload) => {
        if (payload.new) setDrillSession(payload.new);
      })
      .subscribe();
    return () => {
      if (channel) sb.removeChannel(channel);
    };
  }, [sb]);

  // Poll drill session as a fallback if realtime is delayed
  React.useEffect(() => {
    if (!sb) return;
    const t = setInterval(async () => {
      const { data, error } = await sb.from("drill_session").select("*").eq("id", 1).single();
      if (!error && data) setDrillSession(data);
    }, 5000);
    return () => clearInterval(t);
  }, [sb]);

  // Load stretch session + subscribe to realtime
  React.useEffect(() => {
    let channel = null;
    if (!sb) return;
    const loadStretchSession = async () => {
      const { data, error } = await sb.from("stretch_session").select("*").eq("id", 1).single();
      if (!error) setStretchSession(data);
      setStretchReady(true);
    };
    loadStretchSession();
    channel = sb.channel("stretch_session")
      .on("postgres_changes", { event: "*", schema: "public", table: "stretch_session", filter: "id=eq.1" }, (payload) => {
        if (payload.new) setStretchSession(payload.new);
      })
      .subscribe();
    return () => {
      if (channel) sb.removeChannel(channel);
    };
  }, [sb]);

  // Poll stretch session as a fallback if realtime is delayed
  React.useEffect(() => {
    if (!sb) return;
    const t = setInterval(async () => {
      const { data, error } = await sb.from("stretch_session").select("*").eq("id", 1).single();
      if (!error && data) setStretchSession(data);
    }, 5000);
    return () => clearInterval(t);
  }, [sb]);

  // Track viewport for responsive layout
  React.useEffect(() => {
    const onResize = () => {
      setIsMobile(window.innerWidth < 900);
      setIsSmall(window.innerWidth < 768);
    };
    window.addEventListener("resize", onResize);
    return () => window.removeEventListener("resize", onResize);
  }, []);

  // Login/logout handlers
  const handleLogin = async (email, password) => {
    if (!sb) return false;
    const { data, error } = await sb.auth.signInWithPassword({ email, password });
    if (error || !data || !data.user) return false;
    const isAllowed = ADMIN_EMAILS.includes((data.user.email || "").toLowerCase());
    if (!isAllowed) {
      await sb.auth.signOut();
      return false;
    }
    setShowLogin(false);
    return true;
  };
  const handleLogout = async () => {
    if (!sb) return;
    await sb.auth.signOut();
  };

  // Publish handler
  const handlePublish = async () => {
    const cfg = {
      drills: selDrills,
      exercises: selExercises,
      stretches: selStretches,
      work,
      rest,
      rounds,
      drillTime,
      dynStretchTime,
      dynStretchRest,
      statStretchTime,
      statStretchRest
    };
    const doLocalPublish = () => {
      localStorage.setItem("bh-tennis-published", JSON.stringify(cfg));
      setPubDrills(selDrills);
      setPubExercises(selExercises);
      setPubStretches(selStretches);
      const url = window.location.origin + window.location.pathname + "#config=" + btoa(JSON.stringify(cfg));
      navigator.clipboard.writeText(url).then(() => {
        setToast("Plan published! Link copied to clipboard.");
        setTimeout(() => setToast(""), 3000);
      });
    };
    if (!sb) { doLocalPublish(); return; }
    const { error } = await sb.from("published_plan").upsert({ id: 1, data: cfg });
    if (error) {
      doLocalPublish();
      setToast("Published locally. Supabase write failed.");
      setTimeout(() => setToast(""), 4000);
      return;
    }
    setPubDrills(selDrills);
    setPubExercises(selExercises);
    setPubStretches(selStretches);
    setToast("Plan published for everyone!");
    setTimeout(() => setToast(""), 3000);
  };

  // Toggle drill selection (admin)
  const toggleDrill = (id) => {
    setSelDrills(sel => {
      const exists = sel.find(d => d.id === id);
      if (exists) return sel.filter(d => d.id !== id);
      return [...sel, { id, time: drillTime }];
    });
  };

  // Toggle exercise selection (admin)
  const toggleExercise = (id) => {
    setSelExercises(sel => sel.includes(id) ? sel.filter(x => x !== id) : [...sel, id]);
  };
  const toggleStretch = (id) => {
    setSelStretches(sel => sel.includes(id) ? sel.filter(x => x !== id) : [...sel, id]);
  };

  // Filtered lists for admin category browsing
  const filteredDrills = DRILLS.filter(d =>
    (drSkill === "All" || d.skill === drSkill)
  );
  const filteredExercises = exCat === "All" ? EXERCISES : EXERCISES.filter(e => e.cat === exCat);
  const filteredStretches = stretchType === "All" ? STRETCHES : STRETCHES.filter(s => s.type === stretchType);

  // The drill list that non-admin players see (only published drills, in order)
  const playerDrills = pubDrills.map(d => {
    const drill = DRILLS.find(x => x.id === d.id);
    return drill ? { drill, time: d.time } : null;
  }).filter(Boolean);

  // The exercise list for non-admin
  const playerExercises = pubExercises.map(id => EXERCISES.find(e => e.id === id)).filter(Boolean);
  const playerStretches = pubStretches.map(id => STRETCHES.find(s => s.id === id)).filter(Boolean);

  // Current drill for viewer
  const currentViewDrill = viewDrill ? DRILLS.find(d => d.id === viewDrill) : null;

  // Practice mode drill
  const orderedDrillIds = admin ? selDrills.map(d => d.id) : pubDrills.map(d => d.id);
  const currentDrillTime = admin
    ? (selDrills.find(d => d.id === viewDrill) || {}).time
    : (pubDrills.find(d => d.id === viewDrill) || {}).time;
  const currentDrillTimeSafe = typeof currentDrillTime === "number" ? currentDrillTime : drillTime;
  const currentDrillIdx = viewDrill ? orderedDrillIds.indexOf(viewDrill) : -1;
  const canNextDrill = currentDrillIdx >= 0 && currentDrillIdx < orderedDrillIds.length - 1;
  const goNextDrill = () => {
    if (!canNextDrill) return;
    const nextId = orderedDrillIds[currentDrillIdx + 1];
    setViewDrill(nextId);
    if (admin) {
      const nextDur = (selDrills.find(d => d.id === nextId) || {}).time || drillTime;
      updateDrillRow({ drill_id: nextId, duration: Math.max(1, Number(nextDur) || 0) });
    }
  };

  // Admin's selected exercises for circuit
  const adminExercises = selExercises.map(id => EXERCISES.find(e => e.id === id)).filter(Boolean);
  const adminStretches = selStretches.map(id => STRETCHES.find(s => s.id === id)).filter(Boolean);

  // Circuit exercises to display
  const circuitExercises = admin ? adminExercises : playerExercises;
  const stretchList = admin ? adminStretches : playerStretches;
  const dynamicList = stretchList.filter(s => s.type === "Dynamic");
  const staticList = stretchList.filter(s => s.type === "Static");
  const displayStretches = stretchList;
  const _stretchTick = stretchTick;

  const getStretchElapsed = (kind) => {
    if (!stretchSession) return 0;
    const status = stretchSession[`${kind}_status`];
    if (status === "paused") return stretchSession[`${kind}_elapsed_at_pause`] || 0;
    if (status !== "running") return 0;
    const start = stretchSession[`${kind}_start_time`];
    if (!start) return 0;
    return Math.max(0, Math.floor((Date.now() - Date.parse(start)) / 1000));
  };
  const getStretchProgress = (kind, list, work, rest) => {
    const safeList = Array.isArray(list) ? list.filter(Boolean) : [];
    const count = safeList.length;
    const safeWork = Math.max(5, Number(work) || 0);
    const safeRest = Math.max(0, Number(rest) || 0);
    if (count === 0) return { idx: -1, phase: "idle" };
    const per = safeWork + safeRest;
    const total = count * safeWork + Math.max(0, count - 1) * safeRest;
    const elapsed = Math.min(getStretchElapsed(kind), total);
    if (elapsed >= total) return { idx: count - 1, phase: "done" };
    const idx = Math.min(count - 1, Math.floor(elapsed / per));
    const cycleStart = idx * per;
    const cyclePos = Math.max(0, elapsed - cycleStart);
    if (idx === count - 1) {
      if (cyclePos < safeWork) return { idx, phase: "stretch" };
      return { idx, phase: "done" };
    }
    if (cyclePos < safeWork) return { idx, phase: "stretch" };
    return { idx, phase: "rest" };
  };
  const dynProgress = getStretchProgress("dyn", dynamicList, dynStretchTime, dynStretchRest);
  const statProgress = getStretchProgress("stat", staticList, statStretchTime, statStretchRest);

  // Equipment summary for circuit exercises
  const summarizeEquipment = (items) => {
    const map = new Map();
    const normalizeName = (raw) => {
      const s = raw.trim().toLowerCase();
      if (!s || s === "none") return null;
      if (s.includes("wall")) return null;
      if (s.includes("med ball") || s.includes("medicine ball")) return "Medicine Balls";
      if (s.includes("agility ladder") || s.includes("ladder")) return "Ladders";
      if (s.includes("cone")) return "Cones";
      if (s.includes("resistance band") || s.includes("band")) return "Bands";
      if (s.includes("dumbbell")) return "Dumbbells";
      if (s.includes("jump rope")) return "Jump Ropes";
      if (s.includes("bench") || s.includes("box")) return "Boxes/Benches";
      if (s.includes("step")) return "Steps";
      return raw.trim().replace(/\s+/g, " ").replace(/\b\w/g, c => c.toUpperCase());
    };
    const addItem = (name, count, weight) => {
      if (!name) return;
      const cur = map.get(name) || { name, count: 0, weights: new Set() };
      cur.count += count || 1;
      if (weight) cur.weights.add(weight);
      map.set(name, cur);
    };
    items.forEach(e => {
      if (!e || !e.equip) return;
      const parts = e.equip.split(/,|\/|\s\+\s/).map(p => p.trim()).filter(Boolean);
      parts.forEach(p => {
        const countMatch = p.match(/^(\d+)\s+/);
        const count = countMatch ? parseInt(countMatch[1], 10) : 1;
        const weightMatch = p.match(/(\d+\s*-\s*\d+\s*(?:lb|lbs|kg|kgs)|\d+\s*(?:lb|lbs|kg|kgs))/i);
        const weight = weightMatch ? weightMatch[1].replace(/\s+/g, "") : null;
        const name = normalizeName(p.replace(/^\d+\s+/, "").replace(weightMatch ? weightMatch[0] : "", "").trim());
        addItem(name, count, weight);
      });
    });
    return Array.from(map.values()).sort((a, b) => a.name.localeCompare(b.name));
  };

  const circuitEquipment = summarizeEquipment(circuitExercises);
  const circuitEquipTotal = circuitEquipment.reduce((sum, item) => sum + (item.count || 0), 0);

  // Global circuit session controls (admin)
  const calcElapsed = () => {
    if (!session || !session.start_time) return 0;
    return Math.max(0, Math.floor((Date.now() - Date.parse(session.start_time)) / 1000));
  };
  const adminStart = async () => {
    const stations = circuitExercises.map(e => e.id);
    if (!sb) return;
    await sb.from("circuit_session").update({
      status: "running",
      start_time: new Date().toISOString(),
      elapsed_at_pause: 0,
      work,
      rest,
      rounds,
      stations
    }).eq("id", 1);
  };
  const adminPause = async () => {
    if (!sb) return;
    await sb.from("circuit_session").update({
      status: "paused",
      elapsed_at_pause: calcElapsed()
    }).eq("id", 1);
  };
  const adminResume = async () => {
    const elapsed = session && session.elapsed_at_pause ? session.elapsed_at_pause : 0;
    if (!sb) return;
    await sb.from("circuit_session").update({
      status: "running",
      start_time: new Date(Date.now() - elapsed * 1000).toISOString()
    }).eq("id", 1);
  };
  const adminReset = async () => {
    if (!sb) return;
    await sb.from("circuit_session").update({
      status: "idle",
      start_time: null,
      elapsed_at_pause: 0
    }).eq("id", 1);
  };

  // Stretch session helpers (admin)
  const calcStretchElapsed = (kind) => {
    if (!stretchSession) return 0;
    const status = stretchSession[`${kind}_status`];
    if (status !== "running") return stretchSession[`${kind}_elapsed_at_pause`] || 0;
    const start = stretchSession[`${kind}_start_time`];
    if (!start) return 0;
    return Math.max(0, Math.floor((Date.now() - Date.parse(start)) / 1000));
  };
  const updateStretchRow = async (patch) => {
    if (!sb) return;
    const { error } = await sb.from("stretch_session").update(patch).eq("id", 1);
    if (error) {
      setToast("Stretch timer update failed. Check Supabase policies.");
      setTimeout(() => setToast(""), 4000);
      return;
    }
    setStretchSession(prev => {
      const base = prev || { id: 1 };
      return Object.assign({}, base, patch);
    });
  };
  const updateStretchSettings = async (nextDyn, nextDynRest, nextStat, nextStatRest) => {
    await updateStretchRow({
      dyn_duration: nextDyn,
      dyn_rest: nextDynRest,
      stat_duration: nextStat,
      stat_rest: nextStatRest
    });
  };
  const adminStretchStart = async (kind) => {
    if (!sb) return;
    const duration = kind === "dyn" ? dynStretchTime : statStretchTime;
    const restVal = kind === "dyn" ? dynStretchRest : statStretchRest;
    const patch = {};
    patch[`${kind}_status`] = "running";
    patch[`${kind}_start_time`] = new Date().toISOString();
    patch[`${kind}_elapsed_at_pause`] = 0;
    patch[`${kind}_duration`] = duration;
    patch[`${kind}_rest`] = restVal;
    await updateStretchRow(patch);
  };
  const adminStretchPause = async (kind) => {
    if (!sb) return;
    const patch = {};
    patch[`${kind}_status`] = "paused";
    patch[`${kind}_elapsed_at_pause`] = calcStretchElapsed(kind);
    await updateStretchRow(patch);
  };
  const adminStretchResume = async (kind) => {
    if (!sb) return;
    const elapsed = calcStretchElapsed(kind);
    const patch = {};
    patch[`${kind}_status`] = "running";
    patch[`${kind}_start_time`] = new Date(Date.now() - elapsed * 1000).toISOString();
    await updateStretchRow(patch);
  };
  const adminStretchReset = async (kind) => {
    if (!sb) return;
    const duration = kind === "dyn" ? dynStretchTime : statStretchTime;
    const restVal = kind === "dyn" ? dynStretchRest : statStretchRest;
    const patch = {};
    patch[`${kind}_status`] = "idle";
    patch[`${kind}_start_time`] = null;
    patch[`${kind}_elapsed_at_pause`] = 0;
    patch[`${kind}_duration`] = duration;
    patch[`${kind}_rest`] = restVal;
    await updateStretchRow(patch);
  };

  // Drill session helpers (admin)
  const updateDrillRow = async (patch) => {
    if (!sb) return;
    const { error } = await sb.from("drill_session").update(patch).eq("id", 1);
    if (error) {
      setToast("Drill timer update failed. Check Supabase policies.");
      setTimeout(() => setToast(""), 4000);
      return;
    }
    setDrillSession(prev => {
      const base = prev || { id: 1 };
      return Object.assign({}, base, patch);
    });
  };
  const calcDrillElapsed = () => {
    if (!drillSession) return 0;
    if (drillSession.status !== "running") return drillSession.elapsed_at_pause || 0;
    if (!drillSession.start_time) return 0;
    return Math.max(0, Math.floor((Date.now() - Date.parse(drillSession.start_time)) / 1000));
  };
  const adminDrillStart = async () => {
    if (!sb) return;
    const dur = Math.max(1, Number(currentDrillTimeSafe) || 0);
    const patch = {
      status: "running",
      start_time: new Date().toISOString(),
      elapsed_at_pause: 0,
      drill_id: viewDrill,
      duration: dur
    };
    await updateDrillRow(patch);
  };
  const adminDrillPause = async () => {
    if (!sb) return;
    const patch = {
      status: "paused",
      elapsed_at_pause: calcDrillElapsed()
    };
    await updateDrillRow(patch);
  };
  const adminDrillResume = async () => {
    if (!sb) return;
    const elapsed = calcDrillElapsed();
    const patch = {
      status: "running",
      start_time: new Date(Date.now() - elapsed * 1000).toISOString()
    };
    await updateDrillRow(patch);
  };
  const adminDrillReset = async () => {
    if (!sb) return;
    const dur = Math.max(1, Number(currentDrillTimeSafe) || 0);
    const patch = {
      status: "idle",
      start_time: null,
      elapsed_at_pause: 0,
      drill_id: viewDrill,
      duration: dur
    };
    await updateDrillRow(patch);
  };

  // Auto-select first circuit station when list changes
  React.useEffect(() => {
    if (circuitExercises.length > 0 && (circuitStIdx < 0 || circuitStIdx >= circuitExercises.length)) {
      setCircuitStIdx(0);
    }
  }, [circuitExercises.length]);

  // Auto-select first drill when view drill is null
  React.useEffect(() => {
    if (!viewDrill) {
      if (admin && selDrills.length > 0) setViewDrill(selDrills[0]);
      else if (!admin && playerDrills.length > 0) setViewDrill(playerDrills[0].id);
    }
  }, [admin, selDrills, playerDrills.length]);

  // --- RENDER ---

  // Button style helpers
  const tabBtn = (active) => ({
    padding:"10px 24px", background:active?BH.navy:BH.g200, color:active?BH.white:BH.navy,
    border:"none", borderRadius:"6px", cursor:"pointer", fontWeight:"bold", fontSize:"14px"
  });

  const catBtn = (active) => ({
    padding:"6px 12px", background:active?BH.navy:BH.g100, color:active?BH.white:BH.navy,
    border:`1px solid ${active?BH.navy:BH.g300}`, borderRadius:"4px", cursor:"pointer", fontSize:"12px"
  });

  return (
    <div style={{minHeight:"100vh", background:BH.offWhite}}>
      {/* Header */}
      <header style={{background:BH.navy, color:BH.white, padding:"16px 24px", display:"flex",
                      justifyContent:"space-between", alignItems:"center",
                      boxShadow:"0 2px 8px rgba(0,0,0,0.15)"}}>
        <div>
          <div style={{fontSize:"20px", fontWeight:"normal", color:BH.white, letterSpacing:"3.5px",
                      fontFamily:"Georgia, 'Times New Roman', serif"}}>BELMONT HILL</div>
          <div style={{fontSize:"12px", opacity:0.85, letterSpacing:"1px"}}>Varsity Tennis</div>
        </div>
        <div style={{display:"flex", gap:"12px", alignItems:"center"}}>
          {admin ? (
            <>
              <span style={{fontSize:"11px", background:BH.maroon, color:BH.white, padding:"4px 10px",
                            borderRadius:"4px", fontWeight:"bold"}}>ADMIN</span>
              <button onClick={handlePublish} style={{padding:"8px 14px", background:BH.maroon, color:BH.white,
                border:"none", borderRadius:"6px", cursor:"pointer", fontSize:"12px", fontWeight:"bold"}}>
                Publish Plan
              </button>
              <button onClick={handleLogout} style={{padding:"8px 14px", background:"rgba(255,255,255,0.15)",
                color:BH.white, border:"none", borderRadius:"6px", cursor:"pointer", fontSize:"12px"}}>
                Logout
              </button>
            </>
          ) : (
            <button onClick={() => setShowLogin(true)} style={{fontSize:"16px", background:"none",
              border:"none", cursor:"pointer", color:BH.white, opacity:0.6, padding:"4px"}}>
              🔒
            </button>
          )}
        </div>
      </header>

      {/* Tab bar */}
      <div style={{display:"flex", justifyContent:"center", gap:"12px", padding:"16px",
                   background:BH.white, borderBottom:`1px solid ${BH.g300}`}}>
        <button onClick={() => { setTab("circuits"); }} style={tabBtn(tab==="circuits")}>
          Circuits
        </button>
        <button onClick={() => { setTab("drills"); }} style={tabBtn(tab==="drills")}>
          Drills
        </button>
        <button onClick={() => { setTab("stretches"); }} style={tabBtn(tab==="stretches")}>
          Stretches
        </button>
      </div>

      {/* Login modal */}
      {showLogin && <LoginModal onLogin={handleLogin} onClose={() => setShowLogin(false)}/>}

      {/* Toast */}
      {toast && (
        <div style={{position:"fixed", bottom:"20px", right:"20px", background:BH.navy, color:BH.white,
                     padding:"12px 20px", borderRadius:"8px", zIndex:500, fontSize:"13px",
                     boxShadow:"0 4px 12px rgba(0,0,0,0.2)"}}>{toast}</div>
      )}

      {/* Main content */}
      <div style={{maxWidth:"1200px", margin:"0 auto", padding:"20px"}}>

        {/* ===== DRILLS TAB ===== */}
        {tab === "drills" && (
          (
            /* Drills View */
            <div style={{display:"flex", gap:"20px", flexDirection:isMobile ? "column" : "row"}}>
              {/* Left sidebar */}
              <div style={{width:isMobile ? "100%" : "300px", flexShrink:0}}>

                {admin ? (
                  /* Admin: category filter + drill list with checkboxes + today's plan summary */
                  <>
                    {/* Skill filter */}
                    <div style={{display:"flex", flexWrap:"wrap", gap:"6px", marginBottom:"16px"}}>
                      {DRILL_SKILLS.map(s => (
                        <button key={s} onClick={() => setDrSkill(s)} style={catBtn(drSkill===s)}>{s}</button>
                      ))}
                    </div>

                    {/* Drill list with checkboxes */}
                    <div style={{background:BH.white, borderRadius:"8px", border:`1px solid ${BH.g300}`,
                                 maxHeight:isSmall ? "260px" : "350px", overflowY:"auto"}}>
                      <div style={{padding:"12px 14px", borderBottom:`1px solid ${BH.g200}`,
                                   fontSize:"13px", fontWeight:"bold", color:BH.navy}}>
                        All Drills
                      </div>
                      {filteredDrills.map(d => (
                        <div key={d.id} style={{padding:isSmall ? "10px 14px" : "8px 14px", display:"flex", gap:"8px", alignItems:"center",
                          cursor:"pointer", borderBottom:`1px solid ${BH.g100}`,
                          background:viewDrill===d.id ? `rgba(59,130,246,0.08)` : "transparent"}}
                          onClick={() => setViewDrill(d.id)}>
                          <input type="checkbox" checked={selDrills.some(x => x.id === d.id)}
                            onChange={(e) => { e.stopPropagation(); toggleDrill(d.id); }}
                            style={{cursor:"pointer", accentColor:BH.navy, transform:isSmall ? "scale(1.1)" : "none"}}/>
                          <div style={{flex:1}}>
                            <div style={{fontSize:isSmall ? "13px" : "12px", fontWeight:"bold", color:BH.navy}}>{d.name}</div>
                            <div style={{fontSize:isSmall ? "11px" : "10px", color:BH.g500}}>{d.skill || d.cat} • {d.diff}</div>
                          </div>
                        </div>
                      ))}
                    </div>

                    {/* Today's Plan summary */}
                    <div style={{background:BH.white, borderRadius:"8px", border:`2px solid ${BH.maroon}`,
                                 marginTop:"16px", overflow:"hidden"}}>
                      <div style={{padding:"10px 14px", background:BH.maroon, color:BH.white,
                                   fontSize:"13px", fontWeight:"bold"}}>
                        Today's Plan ({selDrills.length} drills)
                      </div>
                      <div style={{padding:"8px 14px", maxHeight:isSmall ? "180px" : "200px", overflowY:"auto"}}>
                        {selDrills.length === 0 ? (
                          <div style={{fontSize:"12px", color:BH.g500, padding:"8px 0"}}>
                            Check drills above to build today's plan
                          </div>
                        ) : (
                          selDrills.map((entry, i) => {
                            const d = DRILLS.find(dr => dr.id === entry.id);
                            if (!d) return null;
                            return (
                              <div key={entry.id} style={{display:"flex", gap:"8px", alignItems:"center", padding:isSmall ? "6px 0" : "4px 0",
                                borderBottom:i < selDrills.length-1 ? `1px solid ${BH.g100}` : "none"}}>
                                <span style={{fontSize:"11px", fontWeight:"bold", color:BH.maroon, minWidth:"18px"}}>{i+1}.</span>
                                <div style={{display:"flex", flexDirection:"column", gap:"2px"}}>
                                  <span style={{fontSize:isSmall ? "13px" : "12px", color:BH.navy}}>{d.name}</span>
                                  <div style={{display:"flex", alignItems:"center", gap:"6px"}}>
                                    <span style={{fontSize:"10px", color:BH.g500}}>Time (sec)</span>
                                    <input type="number" value={entry.time}
                                      onChange={(e) => {
                                        const v = Math.max(10, Math.min(900, +e.target.value || 0));
                                        setSelDrills(sel => sel.map(x => x.id === entry.id ? { ...x, time: v } : x));
                                      }}
                                      style={{width:isSmall ? "72px" : "64px", padding:"4px 6px", border:`1px solid ${BH.g300}`, borderRadius:"4px", fontSize:"12px"}}/>
                                  </div>
                                </div>
                                <button onClick={() => toggleDrill(entry.id)} style={{marginLeft:"auto", background:"none",
                                  border:"none", cursor:"pointer", fontSize:"14px", color:BH.g400, padding:"0 2px"}}>×</button>
                              </div>
                            );
                          })
                        )}
                      </div>
                    </div>

                  </>
                ) : (
                  /* Non-Admin: Today's Plan (read-only numbered list) */
                  <div style={{background:BH.white, borderRadius:"8px", border:`2px solid ${BH.maroon}`, overflow:"hidden"}}>
                    <div style={{padding:"12px 16px", background:BH.maroon, color:BH.white}}>
                      <div style={{fontSize:"15px", fontWeight:"bold"}}>Today's Plan</div>
                      <div style={{fontSize:"11px", opacity:0.8}}>{playerDrills.length} drills</div>
                    </div>
                    <div style={{padding:"8px 0"}}>
                    {playerDrills.length === 0 ? (
                      <div style={{padding:"20px 16px", textAlign:"center", fontSize:"13px", color:BH.g500}}>
                        No drills published yet. Check back later!
                      </div>
                    ) : (
                        playerDrills.map((item, i) => (
                          <div key={item.drill.id} onClick={() => setViewDrill(item.drill.id)}
                            style={{padding:"10px 16px", display:"flex", gap:"10px", alignItems:"center",
                              cursor:"pointer", borderBottom:`1px solid ${BH.g100}`,
                              background:viewDrill===item.drill.id ? `rgba(201,162,39,0.12)` : "transparent"}}>
                            <span style={{fontSize:"14px", fontWeight:"bold", color:BH.maroon, minWidth:"24px"}}>{i+1}</span>
                            <div>
                              <div style={{fontSize:"13px", fontWeight:"bold", color:BH.navy}}>{item.drill.name}</div>
                              <div style={{fontSize:"11px", color:BH.g500}}>{item.drill.desc}</div>
                            </div>
                          </div>
                        ))
                      )}
                    </div>
                  </div>
                )}
              </div>

              {/* Right: Drill Viewer */}
              <div style={{flex:1, minWidth:0, position:"relative"}}>
                {viewDrill && (
                  <div style={{
                    position: isMobile ? "relative" : "absolute",
                    top: isMobile ? "auto" : 0,
                    right: isMobile ? "auto" : 0,
                    zIndex:5,
                    width: isMobile ? "100%" : "260px",
                    marginBottom: isMobile ? "12px" : 0
                  }}>
                    <DrillTimer
                      duration={currentDrillTimeSafe}
                      resetKey={viewDrill}
                      onNext={goNextDrill}
                      canNext={canNextDrill}
                      isAdmin={admin}
                      session={drillReady ? drillSession : null}
                      onAdminStart={adminDrillStart}
                      onAdminPause={adminDrillPause}
                      onAdminResume={adminDrillResume}
                      onAdminReset={adminDrillReset}
                    />
                  </div>
                )}
                {currentViewDrill ? (
                  <DrillViewer drill={currentViewDrill}/>
                ) : (
                  <div style={{textAlign:"center", padding:"60px 20px", color:BH.g500}}>
                    {admin ? "Select a drill to preview" : "Waiting for coach..."}
                  </div>
                )}
              </div>
            </div>
          )
        )}

        {/* ===== CIRCUITS TAB ===== */}
        {tab === "circuits" && (
          <div style={{display:"flex", gap:"20px", flexDirection:isMobile ? "column" : "row"}}>
            {/* Left sidebar */}
            <div style={{width:isMobile ? "100%" : "300px", flexShrink:0}}>
              {admin ? (
                /* Admin: category filter + exercise list + settings */
                <>
                  <div style={{display:"flex", flexWrap:"wrap", gap:"6px", marginBottom:"16px"}}>
                    {EX_CATS.map(c => (
                      <button key={c} onClick={() => setExCat(c)} style={catBtn(exCat===c)}>{c}</button>
                    ))}
                  </div>

                  <div style={{background:BH.white, borderRadius:"8px", border:`1px solid ${BH.g300}`,
                               maxHeight:isSmall ? "260px" : "350px", overflowY:"auto"}}>
                    <div style={{padding:"12px 14px", borderBottom:`1px solid ${BH.g200}`,
                                 fontSize:"13px", fontWeight:"bold", color:BH.navy}}>
                      Exercises
                    </div>
                    {filteredExercises.map(e => (
                      <div key={e.id} style={{padding:isSmall ? "10px 14px" : "8px 14px", display:"flex", gap:"8px", alignItems:"center",
                        cursor:"pointer", borderBottom:`1px solid ${BH.g100}`}}
                        onClick={() => toggleExercise(e.id)}>
                        <input type="checkbox" checked={selExercises.includes(e.id)}
                          onChange={() => {}} style={{cursor:"pointer", accentColor:BH.navy, transform:isSmall ? "scale(1.1)" : "none"}}/>
                        <div style={{flex:1}}>
                          <div style={{fontSize:isSmall ? "13px" : "12px", fontWeight:"bold", color:BH.navy}}>{e.name}</div>
                          <div style={{fontSize:isSmall ? "11px" : "10px", color:BH.g500}}>{e.cat} • {e.reps}</div>
                        </div>
                      </div>
                    ))}
                  </div>

                  {/* Timer settings */}
                  <div style={{background:BH.white, borderRadius:"8px", border:`1px solid ${BH.g300}`,
                               marginTop:"16px", padding:"14px"}}>
                    <div style={{fontSize:"13px", fontWeight:"bold", color:BH.navy, marginBottom:"10px"}}>
                      Timer Settings
                    </div>
                    <div style={{display:"flex", flexDirection:"column", gap:"8px"}}>
                      <label style={{fontSize:"12px", color:BH.g700, display:"flex", justifyContent:"space-between", alignItems:"center"}}>
                        Work (sec)
                        <input type="number" value={work} onChange={e => setWork(+e.target.value)}
                          style={{width:"60px", padding:"4px 8px", border:`1px solid ${BH.g300}`, borderRadius:"4px"}} min="10" max="120"/>
                      </label>
                      <label style={{fontSize:"12px", color:BH.g700, display:"flex", justifyContent:"space-between", alignItems:"center"}}>
                        Rest (sec)
                        <input type="number" value={rest} onChange={e => setRest(+e.target.value)}
                          style={{width:"60px", padding:"4px 8px", border:`1px solid ${BH.g300}`, borderRadius:"4px"}} min="5" max="60"/>
                      </label>
                      <label style={{fontSize:"12px", color:BH.g700, display:"flex", justifyContent:"space-between", alignItems:"center"}}>
                        Rounds
                        <input type="number" value={rounds} onChange={e => setRounds(+e.target.value)}
                          style={{width:"60px", padding:"4px 8px", border:`1px solid ${BH.g300}`, borderRadius:"4px"}} min="1" max="10"/>
                      </label>
                    </div>
                  </div>

                  {/* Selected exercises summary */}
                  <div style={{background:BH.white, borderRadius:"8px", border:`2px solid ${BH.maroon}`,
                               marginTop:"16px", overflow:"hidden"}}>
                    <div style={{padding:"10px 14px", background:BH.maroon, color:BH.white,
                                 fontSize:"13px", fontWeight:"bold"}}>
                      Today's Circuit ({selExercises.length} exercises)
                    </div>
                    <div style={{padding:"8px 14px", maxHeight:"150px", overflowY:"auto"}}>
                      {selExercises.length === 0 ? (
                        <div style={{fontSize:"12px", color:BH.g500, padding:"8px 0"}}>
                          Check exercises above to build circuit
                        </div>
                      ) : (
                        selExercises.map((id, i) => {
                          const e = EXERCISES.find(ex => ex.id === id);
                          if (!e) return null;
                          return (
                            <div key={id}
                                 role="button" tabIndex={0}
                                 onClick={() => setCircuitStIdx(i)}
                                 onMouseDown={() => setCircuitStIdx(i)}
                                 onTouchStart={(ev) => { ev.preventDefault(); setCircuitStIdx(i); }}
                                 onTouchEnd={(ev) => { ev.preventDefault(); setCircuitStIdx(i); }}
                                 style={{display:"flex", gap:"8px", alignItems:"center", padding:"3px 0", cursor:"pointer", userSelect:"none"}}>
                              <span style={{fontSize:"11px", fontWeight:"bold", color:BH.maroon, minWidth:"18px"}}>{i+1}.</span>
                              <span style={{fontSize:"12px", color:BH.navy}}>{e.name}</span>
                              <button onClick={(ev) => { ev.stopPropagation(); toggleExercise(id); }} style={{marginLeft:"auto", background:"none",
                                border:"none", cursor:"pointer", fontSize:"14px", color:BH.g400}}>×</button>
                            </div>
                          );
                        })
                      )}
                    </div>
                  </div>


                  {adminExercises.length > 0 && (
                    <div style={{marginTop:"16px"}}>
                      <CircuitTimer work={work} rest={rest} rounds={rounds} exercises={adminExercises}
                        onStation={(i) => { if (Date.now() > circuitManualUntil) setCircuitStIdx(i); }}
                        session={sessionReady ? session : null}
                        isAdmin={admin}
                        onAdminStart={adminStart}
                        onAdminPause={adminPause}
                        onAdminResume={adminResume}
                        onAdminReset={adminReset}/>
                    </div>
                  )}

                  {circuitExercises.length > 0 && (
                    <div style={{background:BH.white, borderRadius:"8px", border:`2px solid ${BH.maroon}`,
                                 marginTop:"16px", overflow:"hidden"}}>
                      <div style={{padding:"10px 14px", background:BH.maroon, color:BH.white,
                                   fontSize:"13px", fontWeight:"bold", display:"flex", justifyContent:"space-between", alignItems:"center"}}>
                        <span>Equipment Needed</span>
                        <span style={{fontSize:"11px", opacity:0.85}}>Total items: {circuitEquipTotal}</span>
                      </div>
                      <div style={{padding:"8px 14px"}}>
                        {circuitEquipment.length === 0 ? (
                          <div style={{fontSize:"12px", color:BH.g500, padding:"6px 0"}}>
                            No equipment required.
                          </div>
                        ) : (
                          <div style={{display:"flex", flexDirection:"column", gap:"6px"}}>
                            {circuitEquipment.map(item => (
                              <div key={item.name} style={{fontSize:"12px", color:BH.g700, display:"flex", justifyContent:"space-between"}}>
                                <span>{item.name}{item.weights.size ? ` (${Array.from(item.weights).join(", ")})` : ""}</span>
                                <span style={{color:BH.g500}}>x{item.count}</span>
                              </div>
                            ))}
                          </div>
                        )}
                      </div>
                    </div>
                  )}
                </>
              ) : (
                /* Non-Admin: Published circuit (read-only) */
                <>
                  <div style={{background:BH.white, borderRadius:"8px", border:`2px solid ${BH.maroon}`, overflow:"hidden"}}>
                    <div style={{padding:"12px 16px", background:BH.maroon, color:BH.white}}>
                      <div style={{fontSize:"15px", fontWeight:"bold"}}>Today's Circuit</div>
                      <div style={{fontSize:"11px", opacity:0.8}}>
                        {playerExercises.length} exercises • {work}s work / {rest}s rest • {rounds} rounds
                      </div>
                    </div>
                    <div style={{padding:"8px 0"}}>
                      {playerExercises.length === 0 ? (
                        <div style={{padding:"20px 16px", textAlign:"center", fontSize:"13px", color:BH.g500}}>
                          No circuit published yet. Check back later!
                        </div>
                      ) : (
                        playerExercises.map((e, i) => (
                        <button key={e.id} type="button"
                            onClick={() => { setCircuitStIdx(i); setCircuitManualUntil(Date.now() + 8000); }}
                            onPointerDown={() => setCircuitStIdx(i)}
                            onPointerUp={() => setCircuitStIdx(i)}
                            onMouseDown={() => setCircuitStIdx(i)}
                            onTouchStart={(ev) => { ev.preventDefault(); setCircuitStIdx(i); }}
                            onTouchEnd={(ev) => { ev.preventDefault(); setCircuitStIdx(i); }}
                            style={{width:"100%", textAlign:"left", padding:"8px 16px", display:"flex", gap:"10px", alignItems:"center",
                              cursor:"pointer", userSelect:"none", border:"none", background:"transparent",
                              borderBottom:`1px solid ${BH.g100}`,
                              outline:"none", pointerEvents:"auto",
                              backgroundColor: circuitStIdx===i ? `rgba(201,162,39,0.12)` : "transparent"}}>
                            <span style={{fontSize:"14px", fontWeight:"bold", color:BH.maroon, minWidth:"24px"}}>{i+1}</span>
                            <div>
                              <div style={{fontSize:"13px", fontWeight:"bold", color:BH.navy}}>{e.name}</div>
                              <div style={{fontSize:"11px", color:BH.g500}}>{e.reps} • {e.equip}</div>
                            </div>
                          </button>
                        ))
                      )}
                    </div>
                  </div>

                  {playerExercises.length > 0 && (
                    <div style={{marginTop:"16px"}}>
                      <CircuitTimer work={work} rest={rest} rounds={rounds} exercises={playerExercises}
                        onStation={(i) => { if (Date.now() > circuitManualUntil) setCircuitStIdx(i); }}
                        session={sessionReady ? session : null}
                        isAdmin={false}
                        onAdminStart={adminStart}
                        onAdminPause={adminPause}
                        onAdminResume={adminResume}
                        onAdminReset={adminReset}/>
                    </div>
                  )}

                  {circuitExercises.length > 0 && (
                    <div style={{background:BH.white, borderRadius:"8px", border:`2px solid ${BH.maroon}`,
                                 marginTop:"16px", overflow:"hidden"}}>
                      <div style={{padding:"10px 14px", background:BH.maroon, color:BH.white,
                                   fontSize:"13px", fontWeight:"bold", display:"flex", justifyContent:"space-between", alignItems:"center"}}>
                        <span>Equipment Needed</span>
                        <span style={{fontSize:"11px", opacity:0.85}}>Total items: {circuitEquipTotal}</span>
                      </div>
                      <div style={{padding:"8px 14px"}}>
                        {circuitEquipment.length === 0 ? (
                          <div style={{fontSize:"12px", color:BH.g500, padding:"6px 0"}}>
                            No equipment required.
                          </div>
                        ) : (
                          <div style={{display:"flex", flexDirection:"column", gap:"6px"}}>
                            {circuitEquipment.map(item => (
                              <div key={item.name} style={{fontSize:"12px", color:BH.g700, display:"flex", justifyContent:"space-between"}}>
                                <span>{item.name}{item.weights.size ? ` (${Array.from(item.weights).join(", ")})` : ""}</span>
                                <span style={{color:BH.g500}}>x{item.count}</span>
                              </div>
                            ))}
                          </div>
                        )}
                      </div>
                    </div>
                  )}
                </>
              )}
            </div>

            {/* Right: Circuit Ring + Timer */}
            <div style={{flex:1, minWidth:0}}>
              {circuitExercises.length === 0 ? (
                <div style={{textAlign:"center", padding:"60px 20px", color:BH.g500}}>
                  {admin ? "Select exercises from the left to build your circuit" : "No circuit published yet."}
                </div>
              ) : (
                <>
                  <CircuitRing stations={circuitExercises} selectedIdx={circuitStIdx}
                    onSelect={(i) => { setCircuitStIdx(i); setCircuitManualUntil(Date.now() + 8000); }}
                    onRemove={admin ? (i) => {
                      const id = circuitExercises[i] && circuitExercises[i].id;
                      if (id) {
                        setSelExercises(sel => sel.filter(x => x !== id));
                        if (circuitStIdx === i) setCircuitStIdx(-1);
                        else if (circuitStIdx > i) setCircuitStIdx(circuitStIdx - 1);
                      }
                    } : null}/>
                  {/* Selected exercise detail card */}
                  {circuitStIdx >= 0 && circuitStIdx < circuitExercises.length && (
                    <div style={{background:BH.white, padding:"16px", borderRadius:"8px", border:`2px solid ${BH.maroon}`, marginTop:"16px", textAlign:"center"}}>
                      <div style={{fontSize:"16px", fontWeight:"bold", color:BH.navy, marginBottom:"4px"}}>
                        {circuitExercises[circuitStIdx].name}
                      </div>
                      <div style={{fontSize:"13px", color:BH.g700, marginBottom:"8px"}}>
                        {circuitExercises[circuitStIdx].desc}
                      </div>
                      <div style={{display:"flex", justifyContent:"center", gap:"16px", fontSize:"12px", color:BH.g500}}>
                        <span>{circuitExercises[circuitStIdx].reps}</span>
                        <span>•</span>
                        <span>{circuitExercises[circuitStIdx].equip}</span>
                      </div>
                      {circuitExercises[circuitStIdx].youtubeId && (
                        <div style={{borderRadius:"8px", overflow:"hidden", border:`1px solid ${BH.g300}`, marginTop:"12px", textAlign:"left"}}>
                          <div style={{padding:"8px 12px", background:BH.navy, display:"flex", alignItems:"center", gap:"8px"}}>
                            <span style={{fontSize:"12px", fontWeight:"bold", color:BH.white}}>Video Demo</span>
                            {(circuitExercises[circuitStIdx].youtubeStart || circuitExercises[circuitStIdx].youtubeEnd) && (
                              <span style={{fontSize:"10px", color:BH.maroon, opacity:0.8}}>
                                {circuitExercises[circuitStIdx].youtubeStart ? `from ${Math.floor(circuitExercises[circuitStIdx].youtubeStart/60)}:${String(circuitExercises[circuitStIdx].youtubeStart%60).padStart(2,"0")}` : ""}
                                {circuitExercises[circuitStIdx].youtubeEnd ? ` to ${Math.floor(circuitExercises[circuitStIdx].youtubeEnd/60)}:${String(circuitExercises[circuitStIdx].youtubeEnd%60).padStart(2,"0")}` : ""}
                              </span>
                            )}
                            <a href={`https://www.youtube.com/watch?v=${circuitExercises[circuitStIdx].youtubeId}`}
                               target="_blank" rel="noopener noreferrer"
                               style={{marginLeft:"auto", fontSize:"10px", color:BH.g200, textDecoration:"underline"}}>
                              Open on YouTube
                            </a>
                          </div>
                          <div style={{position:"relative", paddingBottom:"56.25%", height:0, overflow:"hidden"}}>
                            <iframe
                              src={`https://www.youtube.com/embed/${circuitExercises[circuitStIdx].youtubeId}?${circuitExercises[circuitStIdx].youtubeStart ? "start="+circuitExercises[circuitStIdx].youtubeStart : ""}${circuitExercises[circuitStIdx].youtubeEnd ? "&end="+circuitExercises[circuitStIdx].youtubeEnd : ""}&rel=0&modestbranding=1`}
                              frameBorder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope"
                              allowFullScreen style={{position:"absolute", top:0, left:0, width:"100%", height:"100%"}}/>
                          </div>
                        </div>
                    )}
                  </div>
                )}
                </>
              )}
            </div>
          </div>
        )}

        {/* ===== STRETCHES TAB ===== */}
        {tab === "stretches" && (
          <div style={{display:"flex", gap:"20px", flexDirection:isMobile ? "column" : "row"}}>
            <div style={{width:isMobile ? "100%" : "300px", flexShrink:0}}>
              <div style={{display:"flex", flexWrap:"wrap", gap:"6px", marginBottom:"16px"}}>
                {STRETCH_TYPES.map(t => (
                  <button key={t} onClick={() => setStretchType(t)} style={catBtn(stretchType===t)}>{t}</button>
                ))}
              </div>

              {admin ? (
                <>
                  <div style={{background:BH.white, borderRadius:"8px", border:`1px solid ${BH.g300}`,
                               maxHeight:isSmall ? "260px" : "350px", overflowY:"auto"}}>
                    <div style={{padding:"12px 14px", borderBottom:`1px solid ${BH.g200}`,
                                 fontSize:"13px", fontWeight:"bold", color:BH.navy}}>
                      All Stretches
                    </div>
                    {filteredStretches.map(s => (
                      <div key={s.id} style={{padding:isSmall ? "10px 14px" : "8px 14px", display:"flex", gap:"8px", alignItems:"center",
                        cursor:"pointer", borderBottom:`1px solid ${BH.g100}`}}
                        onClick={() => toggleStretch(s.id)}>
                        <input type="checkbox" checked={selStretches.includes(s.id)}
                          onChange={() => {}} style={{cursor:"pointer", accentColor:BH.navy, transform:isSmall ? "scale(1.1)" : "none"}}/>
                        <div style={{flex:1}}>
                          <div style={{fontSize:isSmall ? "13px" : "12px", fontWeight:"bold", color:BH.navy}}>{s.name}</div>
                          <div style={{fontSize:isSmall ? "11px" : "10px", color:BH.g500}}>{s.type} • {s.area}</div>
                        </div>
                      </div>
                    ))}
                  </div>

                  <div style={{background:BH.white, borderRadius:"8px", border:`2px solid ${BH.navy}`,
                               marginTop:"12px", overflow:"hidden"}}>
                    <div style={{padding:"10px 14px", background:BH.navy, color:BH.white,
                                 fontSize:"13px", fontWeight:"bold"}}>
                      Today's Dynamic Stretches ({dynamicList.length})
                    </div>
                    <div style={{padding:"8px 14px", maxHeight:"140px", overflowY:"auto"}}>
                      {dynamicList.length === 0 ? (
                        <div style={{fontSize:"12px", color:BH.g500, padding:"8px 0"}}>
                          No dynamic stretches selected.
                        </div>
                      ) : (
                        dynamicList.map((s, i) => (
                          <div key={s.id} style={{display:"flex", gap:"8px", alignItems:"center", padding:"3px 0"}}>
                            <span style={{fontSize:"11px", fontWeight:"bold", color:BH.navy, minWidth:"18px"}}>{i+1}.</span>
                            <span style={{fontSize:"12px", color:BH.navy}}>{s.name}</span>
                            <button onClick={(ev) => { ev.stopPropagation(); toggleStretch(s.id); }} style={{marginLeft:"auto", background:"none",
                              border:"none", cursor:"pointer", fontSize:"14px", color:BH.g400}}>×</button>
                          </div>
                        ))
                      )}
                    </div>
                  </div>

                  <div style={{background:BH.white, borderRadius:"8px", border:`2px solid ${BH.maroon}`,
                               marginTop:"12px", overflow:"hidden"}}>
                    <div style={{padding:"10px 14px", background:BH.maroon, color:BH.white,
                                 fontSize:"13px", fontWeight:"bold"}}>
                      Today's Static Stretches ({staticList.length})
                    </div>
                    <div style={{padding:"8px 14px", maxHeight:"140px", overflowY:"auto"}}>
                      {staticList.length === 0 ? (
                        <div style={{fontSize:"12px", color:BH.g500, padding:"8px 0"}}>
                          No static stretches selected.
                        </div>
                      ) : (
                        staticList.map((s, i) => (
                          <div key={s.id} style={{display:"flex", gap:"8px", alignItems:"center", padding:"3px 0"}}>
                            <span style={{fontSize:"11px", fontWeight:"bold", color:BH.maroon, minWidth:"18px"}}>{i+1}.</span>
                            <span style={{fontSize:"12px", color:BH.navy}}>{s.name}</span>
                            <button onClick={(ev) => { ev.stopPropagation(); toggleStretch(s.id); }} style={{marginLeft:"auto", background:"none",
                              border:"none", cursor:"pointer", fontSize:"14px", color:BH.g400}}>×</button>
                          </div>
                        ))
                      )}
                    </div>
                  </div>
                </>
              ) : (
                <div style={{background:BH.white, borderRadius:"8px", border:`2px solid ${BH.maroon}`, overflow:"hidden"}}>
                  <div style={{padding:"12px 16px", background:BH.maroon, color:BH.white}}>
                    <div style={{fontSize:"15px", fontWeight:"bold"}}>Today's Stretches</div>
                    <div style={{fontSize:"11px", opacity:0.8}}>
                      {dynamicList.length} dynamic • {staticList.length} static
                    </div>
                  </div>
                  <div style={{padding:"8px 0"}}>
                    {stretchList.length === 0 ? (
                      <div style={{padding:"20px 16px", textAlign:"center", fontSize:"13px", color:BH.g500}}>
                        No stretches published yet. Check back later!
                      </div>
                    ) : (
                      stretchList.map((s, i) => (
                        <div key={s.id}
                          style={{padding:"8px 16px", display:"flex", gap:"10px", alignItems:"center",
                            borderBottom:`1px solid ${BH.g100}`}}>
                          <span style={{fontSize:"14px", fontWeight:"bold", color:BH.maroon, minWidth:"24px"}}>{i+1}</span>
                          <div>
                            <div style={{fontSize:"13px", fontWeight:"bold", color:BH.navy}}>{s.name}</div>
                            <div style={{fontSize:"11px", color:BH.g500}}>{s.type} • {s.reps}</div>
                          </div>
                        </div>
                      ))
                    )}
                  </div>
                </div>
              )}
              <div style={{background:BH.white, borderRadius:"8px", border:`1px solid ${BH.g300}`, padding:"12px 14px"}}>
                <div style={{fontSize:"12px", fontWeight:"bold", color:BH.navy, marginBottom:"6px"}}>Stretching Notes</div>
                <div style={{fontSize:"12px", color:BH.g700, lineHeight:1.4}}>
                  Dynamic before hitting. Static after practice. Breathe and never force the range.
                </div>
              </div>
            </div>
            <div style={{flex:1, minWidth:0}}>
              {displayStretches.length === 0 ? (
                <div style={{textAlign:"center", padding:"60px 20px", color:BH.g500}}>
                  {admin ? "No stretches selected yet." : "Waiting for coach..."}
                </div>
              ) : (
                <>
                  <div style={{display:"flex", gap:"10px", flexWrap:"wrap", marginBottom:"10px"}}>
                      <div style={{flex:1, minWidth:"220px"}}>
                        <StretchTimer
                          label="Dynamic Timer"
                          color={BH.navy}
                          session={stretchReady ? stretchSession : null}
                          kind="dyn"
                          isAdmin={admin}
                          onAdminStart={() => adminStretchStart("dyn")}
                          onAdminPause={() => adminStretchPause("dyn")}
                          onAdminResume={() => adminStretchResume("dyn")}
                          onAdminReset={() => adminStretchReset("dyn")}
                          list={dynamicList}
                          work={dynStretchTime}
                          rest={dynStretchRest}
                          onWorkChange={(e) => {
                            const v = Math.max(5, +e.target.value || 0);
                            setDynStretchTime(v);
                            if (sb) updateStretchSettings(v, dynStretchRest, statStretchTime, statStretchRest);
                          }}
                          onRestChange={(e) => {
                            const v = Math.max(0, +e.target.value || 0);
                            setDynStretchRest(v);
                            if (sb) updateStretchSettings(dynStretchTime, v, statStretchTime, statStretchRest);
                          }}
                        />
                      </div>
                      <div style={{flex:1, minWidth:"220px"}}>
                        <StretchTimer
                          label="Static Timer"
                          color={BH.maroon}
                          session={stretchReady ? stretchSession : null}
                          kind="stat"
                          isAdmin={admin}
                          onAdminStart={() => adminStretchStart("stat")}
                          onAdminPause={() => adminStretchPause("stat")}
                          onAdminResume={() => adminStretchResume("stat")}
                          onAdminReset={() => adminStretchReset("stat")}
                          list={staticList}
                          work={statStretchTime}
                          rest={statStretchRest}
                          onWorkChange={(e) => {
                            const v = Math.max(5, +e.target.value || 0);
                            setStatStretchTime(v);
                            if (sb) updateStretchSettings(dynStretchTime, dynStretchRest, v, statStretchRest);
                          }}
                          onRestChange={(e) => {
                            const v = Math.max(0, +e.target.value || 0);
                            setStatStretchRest(v);
                            if (sb) updateStretchSettings(dynStretchTime, dynStretchRest, statStretchTime, v);
                          }}
                        />
                      </div>
                  </div>
                  <div style={{display:"grid", gridTemplateColumns:isSmall ? "1fr" : "1fr 1fr", gap:"14px"}}>
                    <div>
                      <div style={{fontSize:"13px", fontWeight:"bold", color:BH.navy, margin:"4px 0 10px"}}>Pre-Practice</div>
                      <div style={{background:BH.white, borderRadius:"8px", border:`1px solid ${BH.g300}`}}>
                        {dynamicList.length === 0 ? (
                          <div style={{padding:"16px", fontSize:"12px", color:BH.g500}}>No dynamic stretches selected.</div>
                        ) : (
                          dynamicList.map((s, i) => {
                            const isActive = i === dynProgress.idx && dynProgress.phase === "stretch";
                            return (
                            <div key={s.id} style={{
                              padding:"10px 14px",
                              borderBottom:`1px solid ${BH.g100}`,
                              background: isActive ? "rgba(27,54,93,0.08)" : "transparent"
                            }}>
                              <div style={{display:"flex", justifyContent:"space-between", alignItems:"center", gap:"10px"}}>
                                <div style={{fontSize:"13px", fontWeight:"bold", color:BH.navy}}>{i+1}. {s.name}</div>
                                <span style={{fontSize:"10px", color:BH.white, background:BH.navy, padding:"3px 8px",
                                  borderRadius:"999px", fontWeight:"bold", letterSpacing:"0.3px"}}>Dynamic</span>
                              </div>
                              <div style={{fontSize:"11px", color:BH.g700, marginTop:"4px"}}>{s.desc}</div>
                              <div style={{fontSize:"11px", color:BH.g500, marginTop:"4px"}}>{s.area} • {s.reps}</div>
                            </div>
                          );
                          })
                        )}
                      </div>
                    </div>
                    <div>
                      <div style={{fontSize:"13px", fontWeight:"bold", color:BH.navy, margin:"4px 0 10px"}}>After Practice</div>
                      <div style={{background:BH.white, borderRadius:"8px", border:`1px solid ${BH.g300}`}}>
                        {staticList.length === 0 ? (
                          <div style={{padding:"16px", fontSize:"12px", color:BH.g500}}>No static stretches selected.</div>
                        ) : (
                          staticList.map((s, i) => {
                            const isActive = i === statProgress.idx && statProgress.phase === "stretch";
                            return (
                            <div key={s.id} style={{
                              padding:"10px 14px",
                              borderBottom:`1px solid ${BH.g100}`,
                              background: isActive ? "rgba(122,28,42,0.08)" : "transparent"
                            }}>
                              <div style={{display:"flex", justifyContent:"space-between", alignItems:"center", gap:"10px"}}>
                                <div style={{fontSize:"13px", fontWeight:"bold", color:BH.navy}}>{i+1}. {s.name}</div>
                                <span style={{fontSize:"10px", color:BH.white, background:BH.maroon, padding:"3px 8px",
                                  borderRadius:"999px", fontWeight:"bold", letterSpacing:"0.3px"}}>Static</span>
                              </div>
                              <div style={{fontSize:"11px", color:BH.g700, marginTop:"4px"}}>{s.desc}</div>
                              <div style={{fontSize:"11px", color:BH.g500, marginTop:"4px"}}>{s.area} • {s.reps}</div>
                            </div>
                          );
                          })
                        )}
                      </div>
                    </div>
                  </div>
                </>
              )}
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

// Mount the app
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App/>);

  </script>
</body>
</html>
